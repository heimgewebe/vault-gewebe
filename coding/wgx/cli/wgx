#!/usr/bin/env bash
set -euo pipefail

# WGX_DIR auf Root des Repos setzen (egal woher das Skript aufgerufen wird)
# see https://stackoverflow.com/a/246128/1329369
SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ]; do
  DIR="$(cd -P "$(dirname "$SOURCE")" >/dev/null 2>&1 && pwd)"
  SOURCE="$(readlink "$SOURCE")"
  [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
done
WGX_DIR="$(cd -P "$(dirname "$SOURCE")/.." >/dev/null 2>&1 && pwd)"
export WGX_DIR

# libs laden (alphabetisch hält Ordnung)
if [ -d "$WGX_DIR/lib" ]; then
  for f in "$WGX_DIR/lib/"*.bash; do
    if [ -r "$f" ]; then
      if [[ ${WGX_DEBUG:-0} != 0 ]]; then
        echo "Loading library: $f" >&2
      fi
      if ! source "$f"; then
        echo "Error: Failed to source library file: $f" >&2
        exit 1
      fi
    fi
  done
fi

# Default-Branch / Basis für Reload
: "${WGX_BASE:=main}"

# Haupteinstieg
wgx_main "$@"
