# üåê Weltgewebe v14.4 ‚Äî Vollst√§ndige Blaupause mit direkter Demokratie, strukturellen Ankerpunkten, Peer-Verifikation, DSGVO-Konformit√§t & gestufter Kostenarchitektur

## 0) Leitplanken & Prinzipien (unverhandelbar)

**Philosophische Grundlagen:**
- **Alles ist Event**: Append-only, unver√§nderlich; Hash-Kette pro Aggregat mit ed25519-Signaturen f√ºr Byzantine-tolerante Konsistenz
- **Radikale Transparenz**: Jede Aktion erzeugt Events ‚Äì inkl. Fehler (EventRejected) und Admin-Aktionen (AdminActionExecuted) mit vollst√§ndigem Audit-Trail
- **Sichtbarkeit ist aktionsbezogen**: Rollen rotieren 7 Sekunden nach jeder Webungsaktion (Edit, Faden, Antrag, Verzwirnen, Entzwirnen, Spende)
- **Fadenpflicht**: Jede aktive Nutzeraktion an einem Karten-Knoten erzeugt automatisch einen Faden von dessen Rolle zum Handlungsort (Subtyp je Aktion)
- **Strukturknoten als Ankerpunkte**: Gewebekonto, Webrat und N√§hst√ºbchen sind permanente, fixierte Kartenelemente mit spezieller Semantik
- **Sichtbarkeit ist W√§hrung**: Sichtbares Engagement, Ressourcen und Spenden bilden den Wert. Passive Betrachtung bleibt neutral
- **Peer-Verifikation & Autonomie**: Ed25519-signierte Events, Byzantine-tolerante Konsistenz, Datenschutz by Design, DSGVO-konform
- **Privacy by Design**: PII-Trennung, granulare Einwilligungen, Pseudonymisierung statt L√∂schung, Recht auf Vergessen durch Anonymisierung
- **Global skalierbar**: Von Nachbarschaft bis weltweites Myzel mit R√ºckrufbarkeit aller Delegierten

**Technische Leitplanken:**
- **Small-Team-Ops**: 1-2 Personen betreibbar, MTTR ‚â§15 min, automatisierte Runbooks, Healthchecks (/health/live, /health/ready)
- **Gestufte Kostenarchitektur**: Phase A <‚Ç¨250/Monat, Phase B <‚Ç¨600/Monat, Phase C community-finanziert
- **Kosteneffizienz**: Ziel <‚Ç¨0,01/1.000 Events; Echtzeit-Kosten-Metrik im Dashboard
- **JetStream-Kern mit Peer-Network**: NATS JetStream als unverr√ºckbarer Event-Backbone, Redis f√ºr Fallback & Speed-Layer, Leafnodes f√ºr F√∂deration
- **Community-First**: Phase A liefert vollst√§ndige lokale Weberei-Erfahrung ab Tag 1

**Visualsprache:**
- **Faden** = verg√§nglich (7-Tage Fade), farbkodiert nach Subtyp
- **Garn** = verzwirnte F√§den (permanent, sichtbar verzwirnt), sch√ºtzt Knoten vor Verfall
- **Goldfaden** = Spenden (Finanzfluss, goldfarbig)
- **Strukturknoten** = Gewebekonto (gold), Webrat (rot), N√§hst√ºbchen (blau) als permanente Kartenelemente
- **Mehrfachf√§den** = intelligente √úberlappung bei mehreren F√§den zwischen gleichen Punkten
- **Webungs-Rotation** = 7s-Drehung der Garnrolle nach jeder Webungsaktion (global sichtbar)
- **Anonyme Rollen** = Grauer "Anonym-Rolle-XYZ" Marker bei Pseudonymisierung

***

## 1) UX & Informationsarchitektur

### 1.1 Karten-Zentralansicht (MapLibre GL) mit Strukturknoten & Datenschutz-Bewusstsein

**Standardzustand:** Vollbild-Karte mit mobile-first Design und permanenten strukturellen Ankerpunkten.

**Strukturknoten (immer sichtbar, nie verfallend):**
- **Gewebekonto** (goldenes Kassensymbol): Zentraler Finanzknoten f√ºr alle Goldfaden-Str√∂me
- **Webrat** (rotes Parlamentssymbol): Governance-Hub f√ºr Antr√§ge und Abstimmungen  
- **N√§hst√ºbchen** (blaues Kommunikationssymbol): Ortsunabh√§ngiger Diskussions-Raum

**Pull-Tabs (ausziehbare Drawer):**
- **Links**: "Webrat & N√§hst√ºbchen" (360px desktop, modal mobile)
  - **Integrierter Governance- und Chat-Bereich** verkn√ºpft mit Strukturknoten
  - Thread-Liste (pinnable, zuletzt aktiv), Rich-Text Editor
  - Live-Abstimmungs-Interface f√ºr sofortige Partizipation
- **Rechts**: "Filter & Ebenen" (300px desktop)
  - Toggles: Knotenarten, Zeitfenster (24h/7d/Snapshots), Delegationen, Goldf√§den, Governance-Marker
  - **Fadenarten-Filter**: Erweiterte Toggles f√ºr jeden Subtyp (Gespr√§ch, Gestaltung, Ver√§nderung, Antrag, Abstimmung, Gold, Delegation)
  - **Mehrfachf√§den-Toggle**: Ein/Aus f√ºr √ºberlappende Darstellung mit progressiver √úberlappungslogik
  - **Strukturknoten-Filter**: Spezielle Kontrollen f√ºr Gewebekonto/Webrat/N√§hst√ºbchen-Verbindungen
  - **Datenschutz-Filter**: "Nur Einverst√§ndnis-Rollen", "Anonyme Rollen ausblenden"
  - Fadenarten-Legende (farbkodiert), H3-Aufl√∂sung adaptiv zu Zoom-Level
- **Oben Mitte**: "Gewebekonto-Visualisierung" (verkn√ºpft mit Strukturknoten)
  - Dashboard mit Live-Saldo/Bewegungen, ausstehende SEPA/FinTS
  - CSV/JSON-Export, vollst√§ndige Transparenz-Links
  - Goldfaden-Routing zu/von Gewebekonto-Strukturknoten
- **Oben rechts**: "Konto-Zugriff mit Peer-Verifikation & Datenschutz-Status"
  - **Eingeloggt**: Eigene Garnrolle in Profilfarbe mit **Webungs-Rotation** + **Peer-Verifikations-Haken** + **DSGVO-Status-Indikator** ‚Üí √∂ffnet Profil-Drawer
  - **Ausgeloggt**: Graues Rollen-Icon mit "+" Badge ‚Üí √∂ffnet Login-Drawer
  - **Ed25519-Peer-Verifikation** (2-von-N Quorum), Benachrichtigungen, **Datenschutz & Sichtbarkeit**, Feature-Flags

**Rollen-Darstellung mit Datenschutz-Awareness:**
```typescript
interface RolleVisualization {
  id: string;
  displayName: string; // "Max Mustermann" oder "Anonym-Rolle-A7B2"
  avatar: string; // Profilbild oder "anon"
  coords: [number, number]; // H3-Zellenmittelpunkt (ggf. generalisiert)
  isAnonymized: boolean;
  consentStatus: {
    profilePublic: boolean;
    geoPublic: boolean;
    graphPublic: boolean;
    donationPublic: boolean;
  };
  peerVerified: boolean;
}

// Render-Logik ber√ºcksichtigt Einwilligungen
function renderRolleMarker(rolle: RolleVisualization) {
  if (!rolle.consentStatus.geoPublic && !isSelfRole(rolle.id)) {
    return; // Rolle nicht sichtbar ohne Geo-Einwilligung
  }
  
  const marker = {
    position: rolle.coords,
    icon: rolle.isAnonymized ? 'anon-role' : rolle.avatar,
    label: rolle.displayName,
    opacity: rolle.isAnonymized ? 0.7 : 1.0,
    className: rolle.isAnonymized ? 'anonymized-role' : 'regular-role'
  };
  
  return marker;
}
```

### 1.2 Erweiterte Mehrfachf√§den-Visualisierung mit Datenschutz-Filtern

**Intelligente √úberlappung** f√ºr mehrere F√§den zwischen gleichen Punkten mit Datenschutz-Awareness:

```typescript
// Enhanced progressive overlap mit Privacy-Filter
function calculateProgressiveOverlapWithPrivacy(
  faeden: FadenBundle[], 
  userConsentLevels: ConsentMatrix,
  maxSpread: number = 24
): RenderableFadenBundle[] {
  // Filtere F√§den basierend auf Einwilligungen
  const visibleFaeden = faeden.filter(faden => {
    const fromRolleConsent = userConsentLevels[faden.fromRolle];
    const isGraphPublic = fromRolleConsent?.graphPublic ?? false;
    
    // Eigene F√§den immer sichtbar
    if (faden.fromRolle === currentUser.rolleId) return true;
    
    // Anonyme Rollen: F√§den sichtbar, aber ohne Personenbezug
    if (fromRolleConsent?.isAnonymized) return true;
    
    // Andere Rollen: nur mit expliziter Graph-Einwilligung
    return isGraphPublic;
  });
  
  const count = visibleFaeden.length;
  if (count === 1) return visibleFaeden.map(f => ({ ...f, offset: 0 }));
  
  // Progressive √úberlappung
  const overlapFactor = Math.min(0.8, Math.pow((count - 1) / 15, 0.7)); 
  const effectiveSpread = maxSpread * (1 - overlapFactor);
  const step = effectiveSpread / (count - 1);
  
  return visibleFaeden.map((faden, i) => ({
    ...faden,
    offset: -effectiveSpread/2 + i * step,
    isAnonymized: userConsentLevels[faden.fromRolle]?.isAnonymized ?? false
  }));
}

// MapLibre Integration mit Privacy-Styling
map.addLayer({
  id: `faden-${groupKey}-${i}`,
  type: 'line',
  source: 'faeden',
  paint: {
    'line-color': bundle.isAnonymized 
      ? ['case', 
          ['get', 'isStructural'], '#888888', // Anonyme strukturelle F√§den
          '#CCCCCC' // Anonyme normale F√§den
        ]
      : this.getFadenColor(faden.subtype), // Normale Farbkodierung
    'line-width': bundle.isStructural ? 3 : 2,
    'line-opacity': bundle.isAnonymized ? 0.5 : ['get','opacity'],
    'line-offset': offsets[i],
    'line-dasharray': bundle.isAnonymized ? [2, 2] : null // Gestrichelt f√ºr anonyme F√§den
  }
});
```

### 1.3 Webungs-Rotation mit Peer-Verifikations-Status & Datenschutz-Indikatoren

**Konzept:** Jede Webungsaktion triggert eine sichtbare **7-Sekunden-Drehung** der Garnrolle mit Peer-Status und Datenschutz-Indikatoren:

```svelte
<script>
  import { onMount } from 'svelte';
  import { socket } from '$lib/socket';
  import { peerConsensus } from '$lib/peer-verification';
  import { privacyStatus } from '$lib/privacy';
  
  export let rolle;
  
  let spinning = false;
  let peerStatus = 'verified'; // 'verified' | 'pending' | 'unverified'
  let privacyLevel = 'public'; // 'public' | 'partial' | 'anonymous'
  let spinTimer;
  
  function triggerSpin(ms = 7000, actionType = 'unknown') {
    clearTimeout(spinTimer);
    spinning = true;
    
    // Peer-Status w√§hrend Rotation aktualisieren
    peerStatus = 'pending';
    
    spinTimer = setTimeout(() => {
      spinning = false;
      peerStatus = 'verified'; // Nach erfolgreicher Rotation
    }, ms);
  }
  
  // Lokale Aktion (optimistisch): sofort drehen
  export function onLocalAction(actionType) {
    triggerSpin(7000, actionType);
  }
  
  onMount(() => {
    // Standard Webungs-Rotation Events
    socket.on('role-action', (msg) => {
      if (msg.rolleId === rolle.id) {
        triggerSpin((msg.durationSec ?? 7) * 1000, msg.aktionTyp);
      }
    });
    
    // Peer-Consensus Events f√ºr Verifikations-Status
    socket.on('peer-consensus', (msg) => {
      if (msg.rolleId === rolle.id) {
        peerStatus = msg.status; // 'verified' | 'pending' | 'failed'
      }
    });
    
    // Privacy-Status Updates
    socket.on('privacy-status', (msg) => {
      if (msg.rolleId === rolle.id) {
        privacyLevel = msg.level; // 'public' | 'partial' | 'anonymous'
      }
    });
  });
</script>

<div 
  class="rolle-marker {spinning ? 'spin' : ''} peer-{peerStatus} privacy-{privacyLevel}" 
  aria-label="Rolle {rolle.name} {spinning ? '(k√ºrzlich aktiv)' : ''} - Peer-Status: {peerStatus} - Datenschutz: {privacyLevel}"
>
  <div class="garnrolle" style="background: {rolle.farbe}">
    <!-- Multi-Status-Indikator -->
    <div class="status-indicators">
      <!-- Peer-Verifikations-Indikator -->
      <div class="peer-indicator" class:verified={peerStatus === 'verified'}>
        {#if peerStatus === 'verified'}
          <span class="verified-icon">‚úì</span>
        {:else if peerStatus === 'pending'}
          <span class="pending-icon">‚è≥</span>
        {:else}
          <span class="unverified-icon">‚ö†Ô∏è</span>
        {/if}
      </div>
      
      <!-- Datenschutz-Indikator -->
      <div class="privacy-indicator privacy-{privacyLevel}">
        {#if privacyLevel === 'public'}
          <span class="public-icon">üëÅÔ∏è</span>
        {:else if privacyLevel === 'partial'}
          <span class="partial-icon">üëÅÔ∏è‚Äçüó®Ô∏è</span>
        {:else}
          <span class="anonymous-icon">üï∂Ô∏è</span>
        {/if}
      </div>
    </div>
  </div>
</div>

<style>
.rolle-marker { 
  width: 36px; /* Erweitert f√ºr Multi-Status-Indikatoren */
  height: 36px; 
  border-radius: 50%; 
  position: relative; 
}

.garnrolle { 
  width: 100%; 
  height: 100%; 
  border-radius: 50%; 
  background: radial-gradient(#c28a3a,#8a5a1a); 
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  position: relative;
}

.status-indicators {
  position: absolute;
  top: -4px;
  right: -4px;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.peer-indicator, .privacy-indicator {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 8px;
  border: 1px solid;
}

.peer-indicator.verified {
  border-color: #28a745;
  color: #28a745;
}

.peer-indicator:not(.verified) {
  border-color: #ffc107;
  color: #ffc107;
}

.privacy-indicator.privacy-public {
  border-color: #007bff;
  color: #007bff;
}

.privacy-indicator.privacy-partial {
  border-color: #fd7e14;
  color: #fd7e14;
}

.privacy-indicator.privacy-anonymous {
  border-color: #6c757d;
  color: #6c757d;
}

/* Anonymisierte Rollen haben spezielle Darstellung */
.rolle-marker.privacy-anonymous .garnrolle {
  background: radial-gradient(#999, #666);
  opacity: 0.7;
}

@media (prefers-reduced-motion: no-preference) {
  .spin .garnrolle { 
    animation: rollspin 7s linear; 
  }
  
  @keyframes rollspin {
    from { transform: rotate(0deg) }
    to   { transform: rotate(3600deg) } /* 10 Umdrehungen in 7s */
  }
}

/* A11y fallback: kurzer Glanz statt Rotation */
@media (prefers-reduced-motion: reduce) {
  .spin .garnrolle { 
    animation: glow 800ms ease-out; 
  }
  
  @keyframes glow {
    0% { box-shadow: 0 0 0 0 rgba(255,215,0,.7) }
    100% { box-shadow: 0 0 0 12px rgba(255,215,0,0) }
  }
}

/* Strukturknoten-spezifisches Styling */
.rolle-marker.structural .garnrolle {
  background: linear-gradient(45deg, #d4af37, #ffd700); /* Gold f√ºr Strukturknoten-Interaktionen */
}
</style>
```

### 1.4 Knotenr√§ume mit Strukturknoten-Integration & Datenschutz-Controls

**Automatik:** Jeder Knoten erzeugt automatisch bei Kn√ºpfung seinen Raum, **Strukturknoten haben erweiterte Interfaces:**
- **Standard-Knoten**: Info | Threads | Gestalten | Teilnehmende | Historie | **Datenschutz**
- **Gewebekonto-Raum**: + Finanzdashboard, SEPA-Integration, Transparenz-Export, **Spendenverkl√§rung**
- **Webrat-Raum**: + Antrags√ºbersicht, aktive Abstimmungen, Delegations-Management, **Governance-Transparenz**
- **N√§hst√ºbchen-Raum**: + Moderations-Tools, Thread-Archiv, Community-Guidelines, **Diskussionsregeln**

**Datenschutz-Tab in Knotenr√§umen:**
```svelte
<div class="datenschutz-controls">
  <h4>Datenschutz & Sichtbarkeit</h4>
  
  <div class="visibility-settings">
    <label class="toggle">
      <input type="checkbox" bind:checked={settings.showInPublicLists} />
      <span>In √∂ffentlichen Listen sichtbar</span>
    </label>
    
    <label class="toggle">
      <input type="checkbox" bind:checked={settings.allowExternalReferences} />
      <span>Externe Verlinkung erlauben</span>
    </label>
    
    <label class="toggle">
      <input type="checkbox" bind:checked={settings.shareWithStructuralNodes} />
      <span>Mit Strukturknoten verkn√ºpfbar</span>
    </label>
  </div>
  
  <div class="data-retention">
    <h5>Aufbewahrung</h5>
    <select bind:value={settings.retentionPolicy}>
      <option value="standard">Standard (7 Tage Fade + Garn-Schutz)</option>
      <option value="extended">Erweitert (30 Tage + Garn-Schutz)</option>
      <option value="minimal">Minimal (3 Tage + Garn-Schutz)</option>
    </select>
  </div>
  
  <div class="export-controls">
    <button on:click={requestDataExport}>üìÑ Daten exportieren</button>
    <button on:click={requestAnonymization}>üï∂Ô∏è Beitr√§ge anonymisieren</button>
  </div>
</div>
```

### 1.5 Login & Authentifizierung mit DSGVO-konformem Onboarding

**Login-Drawer mit Datenschutz-First-Approach:**
```svelte
<div class="login-drawer">
  <h3>Weberei-Zugang ‚Äì kryptographisch gesichert & datenschutzkonform</h3>
  <p>Ed25519-Peer-Verifikation f√ºr Byzantine-tolerante Sicherheit.<br>
     <strong>Du bestimmst vollst√§ndig, was sichtbar ist.</strong> Granulare Privatsph√§re-Kontrolle.</p>
  
  <!-- Datenschutz-Hinweis prominent -->
  <div class="privacy-notice">
    <h4>üîí Deine Daten, deine Kontrolle</h4>
    <p>
      ‚Ä¢ Keine versteckten Cookies oder Tracking<br>
      ‚Ä¢ Sichtbar nur, was du freigibst<br>
      ‚Ä¢ Jederzeit widerrufbare Einwilligungen<br>
      ‚Ä¢ Anonymisierung statt unwiderruflicher L√∂schung
    </p>
    <details>
      <summary>Vollst√§ndige Datenschutzerkl√§rung anzeigen</summary>
      <div class="full-privacy-policy">
        <p><strong>Datenschutz in der Weberei</strong></p>
        <p>Wir verarbeiten nur Daten, die du selbst eintr√§gst. Es gibt kein Tracking, keine versteckten Cookies, keine Profilbildung. Sichtbar ist nur, was du freigibst: Name, Wohnort-Verortung, Verbindungen im Gewebe.</p>
        <p>Du kannst deine Daten jederzeit exportieren, berichtigen, Einwilligungen widerrufen oder deine Rolle anonymisieren (PII-L√∂schung, Rolle bleibt verortet auf gr√∂berer H3-Zelle). Server- und Sicherheitslogs sind kurzlebig und nur pseudonymisiert (rotierender Hash).</p>
        <p><strong>Rechtsgrundlagen:</strong> Art. 6 Abs. 1 lit. a (Einwilligung) und lit. f DSGVO (berechtigtes Interesse an sicherer Gemeinschaftsorganisation).</p>
        <p><strong>Fristen:</strong> Auskunft/L√∂schung binnen 30 Tagen. Verantwortlicher und Kontakt wie im Impressum.</p>
      </div>
    </details>
  </div>
  
  <button class="passkey-btn" on:click={loginWithPasskey}>
    üîê Mit Passkey anmelden (Ed25519)
  </button>
  
  <div class="magic-link">
    <input type="email" placeholder="E-Mail f√ºr Krypto-Link" bind:value={email} />
    <button on:click={sendCryptoMagicLink}>Signierten Link senden</button>
  </div>
  
  {#if FF_OIDC}
    <button class="oidc-btn" on:click={loginWithOIDC}>Mit SSO anmelden</button>
  {/if}
  
  <div class="peer-status">
    <h4>Peer-Network Status</h4>
    <div class="peer-indicators">
      {#each activePeers as peer}
        <span class="peer-indicator {peer.status}">{peer.name}</span>
      {/each}
    </div>
  </div>
  
  <button class="anonymous-btn" on:click={continueAnonymous}>Weiter ohne Konto (vollst√§ndig anonym)</button>
</div>
```

### 1.6 DSGVO-konformer Onboarding-Flow

**Erweiterte Interaktive Tour mit Datenschutz-Bildung:**
```svelte
<script>
  import { onMount } from 'svelte';
  import { tourState } from '$lib/stores/tour';
  import { consentState } from '$lib/stores/consent';
  
  const enhancedTourSteps = [
    { 
      target: '[data-testid="karte"]', 
      text: 'Herzlich willkommen! Dies ist deine datenschutzkonforme Weberei-Karte mit strukturellen Ankerpunkten.',
      privacyNote: 'Deine Position wird nur dann angezeigt, wenn du dem zustimmst.'
    },
    { 
      target: '[data-testid="gewebekonto"]', 
      text: 'Das Gewebekonto (gold) ist der zentrale Finanzknoten f√ºr alle Goldf√§den.',
      privacyNote: 'Spenden sind nur mit deiner Einwilligung sichtbar.'
    },
    { 
      target: '[data-testid="webrat"]', 
      text: 'Der Webrat (rot) ist dein Governance-Hub f√ºr direkte Demokratie.',
      privacyNote: 'Abstimmungen sind pseudonym - nur du wei√üt, wie du gestimmt hast.'
    },
    { 
      target: '[data-testid="naehstuebchen"]', 
      text: 'Das N√§hst√ºbchen (blau) verbindet dich ortsunabh√§ngig mit der Community.',
      privacyNote: 'Diskussionen k√∂nnen anonymisiert werden.'
    },
    { 
      target: '[data-testid="datenschutz-controls"]', 
      text: 'Hier kontrollierst du, was von dir sichtbar ist. Granular und jederzeit √§nderbar.',
      privacyNote: 'Das ist dein Datenschutz-Cockpit. Alles unter deiner Kontrolle.'
    },
    { 
      target: '[data-testid="privacy-indicator"]', 
      text: 'Die Datenschutz-Indikatoren zeigen den Sichtbarkeitsstatus jeder Rolle an.',
      privacyNote: 'üëÅÔ∏è = √∂ffentlich, üëÅÔ∏è‚Äçüó®Ô∏è = teilweise, üï∂Ô∏è = anonym'
    }
  ];

  onMount(() => {
    if (localStorage.getItem('tourCompleted') === null && $tourState.enabled) {
      startPrivacyAwareTour(enhancedTourSteps);
    }
  });
  
  async function startPrivacyAwareTour(steps) {
    // Vor Tour: Einwilligungsabfrage
    const basicConsent = await showConsentDialog({
      scopes: ['analytics_min', 'geo_public'],
      explanation: 'F√ºr die Tour ben√∂tigen wir deine Zustimmung zur Anzeige deiner Position auf der Karte.'
    });
    
    if (!basicConsent.granted) {
      // Tour ohne Geo-Features
      const limitedSteps = steps.filter(step => !step.requiresGeo);
      startInteractiveTour(limitedSteps);
    } else {
      startInteractiveTour(steps);
    }
  }
</script>
```

### 1.7 Datenschutz & Sichtbarkeits-Dashboard

**Zentrales Datenschutz-Interface (neuer Drawer):**
```svelte
<div class="privacy-dashboard">
  <h3>üîí Datenschutz & Sichtbarkeit</h3>
  
  <!-- Aktueller Status-√úberblick -->
  <div class="privacy-status-overview">
    <h4>Dein aktueller Status</h4>
    <div class="status-cards">
      <div class="status-card" class:active={consent.profilePublic}>
        <div class="icon">üë§</div>
        <div class="label">Profil √∂ffentlich</div>
        <div class="toggle">
          <input type="checkbox" bind:checked={consent.profilePublic} on:change={updateConsent} />
        </div>
      </div>
      
      <div class="status-card" class:active={consent.geoPublic}>
        <div class="icon">üìç</div>
        <div class="label">Position sichtbar</div>
        <div class="toggle">
          <input type="checkbox" bind:checked={consent.geoPublic} on:change={updateConsent} />
        </div>
      </div>
      
      <div class="status-card" class:active={consent.graphPublic}>
        <div class="icon">üï∏Ô∏è</div>
        <div class="label">Verbindungen sichtbar</div>
        <div class="toggle">
          <input type="checkbox" bind:checked={consent.graphPublic} on:change={updateConsent} />
        </div>
      </div>
      
      <div class="status-card" class:active={consent.donationPublic}>
        <div class="icon">üí∞</div>
        <div class="label">Spenden sichtbar</div>
        <div class="toggle">
          <input type="checkbox" bind:checked={consent.donationPublic} on:change={updateConsent} />
        </div>
      </div>
    </div>
  </div>
  
  <!-- Datenmanagement -->
  <div class="data-management">
    <h4>Deine Daten verwalten</h4>
    <div class="action-buttons">
      <button class="export-btn" on:click={requestDataExport}>
        üìÑ Alle Daten exportieren
      </button>
      <button class="rectify-btn" on:click={openRectificationForm}>
        ‚úèÔ∏è Daten berichtigen
      </button>
      <button class="anonymize-btn" on:click={requestAnonymization}>
        üï∂Ô∏è Rolle anonymisieren
      </button>
      <button class="delete-btn" on:click={requestAccountTermination}>
        üóëÔ∏è Konto beenden
      </button>
    </div>
  </div>
  
  <!-- Datenschutz-Historie -->
  <div class="privacy-history">
    <h4>Datenschutz-Ereignisse</h4>
    <div class="timeline">
      {#each privacyEvents as event}
        <div class="timeline-item">
          <div class="timestamp">{formatDate(event.timestamp)}</div>
          <div class="action">{event.action}</div>
          <div class="details">{event.details}</div>
        </div>
      {/each}
    </div>
  </div>
  
  <!-- Rechtliche Hinweise -->
  <div class="legal-info">
    <details>
      <summary>Rechtliche Grundlagen</summary>
      <div class="legal-details">
        <p><strong>Verarbeitungsgrundlagen (DSGVO):</strong></p>
        <ul>
          <li>Art. 6 Abs. 1 lit. a: Einwilligung (f√ºr √∂ffentliche Sichtbarkeit)</li>
          <li>Art. 6 Abs. 1 lit. f: Berechtigtes Interesse (f√ºr Systemfunktionalit√§t)</li>
        </ul>
        <p><strong>Deine Rechte:</strong> Auskunft, Berichtigung, L√∂schung (durch Anonymisierung), Einschr√§nkung, Daten√ºbertragbarkeit, Widerspruch</p>
        <p><strong>Beschwerderecht:</strong> Bei der zust√§ndigen Datenschutzaufsichtsbeh√∂rde</p>
      </div>
    </details>
  </div>
</div>
```

***

## 2) Dom√§ne & Regeln

### 2.1 Automatik-Grundsatz mit Strukturknoten-Awareness & Datenschutz-Konformit√§t

**Aktion ‚áí Faden + Webungs-Rotation + Peer-Verifikation + Privacy-Check:**
- **Jede aktive Nutzeraktion** an einem Karten-Knoten erzeugt automatisch (sofern Einwilligungen vorliegen):
  1. Einen Faden von der Rolle zum Handlungsort (Subtyp je Aktion)
  2. **Eine 7s-Webungs-Rotation der Rolle** (global sichtbar, wenn `graphPublic`)
  3. **Ed25519-signiertes Event f√ºr Peer-Verifikation**
  4. **Datenschutz-konformen Event-Eintrag** (PII getrennt gespeichert)
- **Strukturknoten-Aktionen** erzeugen spezielle F√§den mit erh√∂hter Sichtbarkeit
- **Passive Aktionen** (ansehen/filtern) bleiben neutral und erzeugen keine personenbezogenen Logs
- **Login** ist eine System-Aktion ‚Üí erzeugt weder Faden noch Rotation, aber Consent-Pr√ºfung

### 2.2 Erweiterte Verzwirn-Schutz mit Peer-Konsens & Datenschutz-Granularit√§t

**Verzwirnung als einzige Quelle der Wahrheit mit Peer-Best√§tigung und Privacy-Awareness:**
- **Grundregel**: Jeder darf jeden Knoten bearbeiten (sofern sichtbar durch Einwilligungen)
- **Schutz**: Verzwirnte Bereiche sind editiersicher
- **Granularit√§t**: Verzwirnung gilt f√ºr spezifische JSON-Pointer-Pfade (z.B. `/title`, `/sections/2`)
- **Vollschutz**: Verzwirnung mit Scope `"full"` sperrt den gesamten Knoten
- **Strukturknoten-Schutz**: Kritische Strukturknoten-Eigenschaften sind per Default verzwirnt
- **Peer-Validierung**: Verzwirnungen erfordern 2-von-N Peer-Best√§tigung f√ºr Validit√§t
- **Datenschutz-Integration**: Verzwirnte Inhalte mit personenbezogenen Daten erfordern Einwilligung des Erstellers

```sql
-- Erweiterte Verzwirnungen-Tabelle mit Peer-Konsens & Privacy
CREATE TABLE verzwirnungen (
  id UUID PRIMARY KEY,
  knoten_id UUID NOT NULL REFERENCES knoten(id) ON DELETE CASCADE,
  rolle_id UUID NOT NULL REFERENCES rollen(id),
  scope JSONB NOT NULL, -- "full" oder ["/title", "/sections/2"]
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  peer_signatures JSONB DEFAULT '[]', -- Ed25519-Signaturen der best√§tigenden Peers
  consensus_achieved BOOLEAN DEFAULT FALSE,
  is_structural BOOLEAN DEFAULT FALSE, -- Strukturknoten-spezifische Verzwirnung
  privacy_impact JSONB DEFAULT '{}', -- Welche personenbezogenen Daten betroffen sind
  consent_required BOOLEAN DEFAULT FALSE, -- Ob Einwilligung f√ºr Sichtbarkeit n√∂tig ist
  anonymization_safe BOOLEAN DEFAULT TRUE -- Ob bei Anonymisierung erhalten bleiben kann
);
```

### 2.3 Knoten-Lebenszyklus mit Strukturknoten-Permanenz & Datenschutz-Zyklen

**Strukturknoten sind permanent, Datenschutz-konform:**
- **Gewebekonto, Webrat, N√§hst√ºbchen** verfallen niemals
- **Standard-Knoten** folgen Garn-Schutz-Regeln: Solange mindestens ein Garn zu einem Knoten f√ºhrt, bleibt er aktiv
- **Verfall startet erst**, wenn letzter Faden/Garn entkn√ºpft/verblasst ist ‚Üí **KnotenStartetVerfall**, expires_at = now()+7d
- **Fade**: UI-Opacity steigt linear 0 ‚Üí 100% in 7 Tagen; dann **KnotenVerfallen** (Historie bleibt in Events/Timeline)
- **Strukturknoten-Verbindungen** beeinflussen Verfallsregeln: Knoten mit Strukturknoten-F√§den haben verl√§ngerte Lebensdauer
- **Datenschutz-√úbersteuerung**: Nutzer k√∂nnen jederzeit eigene Beitr√§ge zu Knoten anonymisieren oder zur L√∂schung vormerken

### 2.4 Direkte Demokratie mit sofortiger Partizipation & Datenschutz-Wahrung

**Revolution√§res Governance-Prinzip mit Privacy-by-Design:**
- **Antr√§ge**: AntragGestellt erzeugt **Antragsfaden** Rolle ‚Üí **Webrat-Strukturknoten** (immer sichtbar); Timer 7 Tage sichtbar
- **Sofortige Abstimmungsf√§higkeit**: Einspruch aktiviert **sofortige Abstimmung ohne Wartezeit**
  - **Einspruch-Limit**: Max. 1 Einspruch pro Rolle pro Antrag (verhindert Trolling)
- **Pseudonyme Abstimmungen**: StimmeAbgegeben wird pseudonymisiert gespeichert, kein direkter R√ºckschluss auf Identit√§t
- **Abstimmungen sind immer g√ºltig**: Unabh√§ngig von der Beteiligung
- **Einfache Mehrheit**: Beschluss gilt bei mehr Ja- als Nein-Stimmen (Enthaltungen neutral)
- **Sofortige Ausf√ºhrung**: Nach Annahme l√∂st Server sofort `ActionExecuted` aus (idempotent, idempotencyKey = antragId)
- **Delegation**: Phase A 1:1; Ablauf nach **4 Wochen Inaktivit√§t** des Delegierenden (Timer). Phase B (Flag): transitiv, Cycle-Check
- **Delegationsf√§den**: Immer sichtbar als graue Pfeile, oft zu Webrat-Strukturknoten, aber anonymisierbar

```typescript
// Privacy-aware Governance Flow
async function processDirectVoteWithPrivacy(abstimmungId: string) {
  const votes = await getVotesForAbstimmung(abstimmungId);
  
  // Pseudonyme Verarbeitung - keine R√ºckschl√ºsse auf individuelle Stimmen
  const ja = votes.filter(v => v.choice === 'ja').length;
  const nein = votes.filter(v => v.choice === 'nein').length;
  
  let result: 'angenommen' | 'abgelehnt';
  if (ja > nein) {
    result = 'angenommen';
    
    // SOFORTIGE Ausf√ºhrung ohne weitere Verz√∂gerung
    const antrag = await getAntragByAbstimmung(abstimmungId);
    await executeActionImmediately(antrag.action, antrag.id);
  } else {
    result = 'abgelehnt';
  }
  
  // Datenschutz-konformes Result-Event (keine individuellen Stimmdaten)
  await eventBus.publish({
    type: 'AbstimmungBeendet',
    payload: { 
      abstimmungId, 
      result, 
      stimmenJa: ja, 
      stimmenNein: nein,
      stimmenGesamt: ja + nein,
      immediateDemocracy: true,
      pseudonymized: true // Flag f√ºr datenschutzkonforme Verarbeitung
    },
    meta: {
      // Keine individuellen Actor-IDs bei Abstimmungsresultaten
      actor: 'system',
      privacyLevel: 'aggregated'
    }
  });
}
```

***

## 3) Event-Schema & Technische Architektur

### 3.1 Erweiterte Event-Schema mit Ed25519-Signaturen, Strukturknoten & DSGVO-Konformit√§t

```json
{
  "id": "01HZXY9ABCDEFGHIJK",           // ULID
  "type": "FadenGesponnen",
  "subtype": "gespr√§ch",               // gespraech|gestaltung|veraenderung|antrag|abstimmung|gold|delegation
  "aggregateId": "knoten-550e8400-e29b-41d4-a716-446655440000",
  "aggregateType": "knoten",           // knoten|faden|rolle|antrag|delegation|zahlung|account|session
  "ts": "2025-08-21T12:00:00.000Z",
  "subject": "wg.kleinroennau.social", // √ñffentlich | "wg.kleinroennau.auth" f√ºr Login-Events | "wg.kleinroennau.privacy" f√ºr DSGVO-Events
  "signature": "ed25519:abc123def456789abcdef...", // Ed25519-Signatur f√ºr Byzantine-Toleranz
  "prev_hash": "sha256:abc123def456...",       // SHA256 des letzten Events f√ºr dieses Aggregat
  "payload": {
    "fromRolle": "rolle-uuid...",
    "toKnoten": "knoten-uuid...",
    "toStructuralType": "webrat",      // Neu: gewebekonto|webrat|naehstuebchen|null
    "content": "Das ist interessant!",
    "expiresAt": "2025-08-26T15:22:00.000Z",
    "h3": 599405658847379,
    "isStructuralConnection": true,    // Neu: Flag f√ºr Strukturknoten-Verbindungen
    "privacyLevel": "public",          // Neu: public|partial|anonymous
    "consentRequired": ["graph_public"] // Neu: Welche Einwilligungen n√∂tig sind
  },
  "meta": {
    "actor": "rolle-uuid...",
    "msgId": "deterministic-dedup-key", // F√ºr Idempotenz
    "ipHash": "sha256(ip+salt+date)",   // Pseudonymisiert mit rotierendem Salt
    "uaHash": "sha256(ua+salt+date)",   // Pseudonymisiert mit rotierendem Salt
    "peerQuorum": ["peer1-id", "peer2-id"], // Peer-Verifikation
    "consensusAchieved": true,          // Byzantine-Konsens Status
    "peerSignatures": {                 // Ed25519-Peer-Best√§tigungen
      "peer1-id": "ed25519:signature1...",
      "peer2-id": "ed25519:signature2..."
    },
    "privacyCompliant": true,           // Neu: DSGVO-Konformit√§ts-Flag
    "consentVersion": "2025-08-21",     // Neu: Version der Einwilligungsrichtlinie
    "retentionPolicy": "standard"       // Neu: 7d|30d|permanent
  }
}
```

### 3.2 Datenschutz-spezifische Events (privater subject "wg.kleinroennau.privacy")

```json
{
  "type": "ConsentGiven",
  "aggregateId": "rolle-uuid",
  "subject": "wg.kleinroennau.privacy",
  "ts": "2025-08-21T12:00:00Z",
  "signature": "ed25519:consent-signature...",
  "payload": {
    "rolleId": "rolle-uuid",
    "scopes": ["profile_public", "geo_public", "graph_public"],
    "policyVersion": "2025-08-21",
    "lang": "de",
    "granularSettings": {
      "profile_public": {
        "includes": ["name", "avatar"],
        "excludes": ["email", "phone"]
      },
      "geo_public": {
        "precision": "h3_level_7", // vs h3_level_6 f√ºr reduzierte Genauigkeit
        "timeRestriction": "active_hours_only"
      }
    }
  },
  "meta": {
    "actor": "rolle-uuid",
    "channel": "ui_explicit", // ui_explicit|ui_implicit|api|migration
    "ipHash": "sha256(ip+salt+date)",
    "browserFingerprint": null, // Explizit kein Fingerprinting
    "legalBasis": "art6_1_a_gdpr"
  }
}
```

```json
{
  "type": "RolePseudonymized",
  "aggregateId": "rolle-uuid",
  "subject": "wg.kleinroennau.privacy",
  "payload": {
    "rolleId": "rolle-uuid",
    "newDisplayName": "Anonym-Rolle-A7B2",
    "avatar": "anon",
    "geoMode": "h3_generalized",
    "h3Resolution": 6, // Gr√∂bere Aufl√∂sung f√ºr Anonymit√§t
    "linkToPII": "removed",
    "retainedData": ["graph_connections", "governance_participation"],
    "removedData": ["full_name", "street", "email", "detailed_location"],
    "reason": "user_erasure_request"
  },
  "meta": {
    "actor": "rolle-uuid",
    "legalBasis": "art17_gdpr", // Recht auf L√∂schung
    "executedBy": "system",
    "auditRequired": true
  }
}
```

```json
{
  "type": "DSR_DataExportReady",
  "aggregateId": "rolle-uuid", 
  "subject": "wg.kleinroennau.privacy",
  "payload": {
    "rolleId": "rolle-uuid",
    "exportId": "export-uuid",
    "downloadUrl": "https://secure.example.com/exports/signed-url",
    "expiresAt": "2025-08-28T12:00:00Z",
    "format": "json", // json|csv|pdf
    "includedData": {
      "profile": true,
      "faeden": true,
      "abstimmungen": true,
      "finanzen": true,
      "interactions": false // Nutzer hat abgelehnt
    },
    "sizeBytes": 1048576,
    "encryptionKey": "age:recipient-public-key" // F√ºr Ende-zu-Ende-Verschl√ºsselung
  },
  "meta": {
    "requestedAt": "2025-08-21T12:00:00Z",
    "processingTimeMs": 15000,
    "legalBasis": "art15_gdpr"
  }
}
```

### 3.3 Strukturknoten-spezifische Events mit Datenschutz-Integration

```json
{
  "type": "StrukturknotenInteraktionMitPrivacy",
  "aggregateId": "strukturknoten-uuid",
  "subject": "wg.kleinroennau.structural",
  "payload": {
    "strukturknotenTyp": "gewebekonto", // gewebekonto|webrat|naehstuebchen
    "interaktionsTyp": "goldfaden_routing",
    "rolleId": "rolle-uuid",
    "targetKnoten": "ziel-knoten-uuid",
    "metadata": {
      "betrag": 1500,           // F√ºr Gewebekonto
      "donationPublic": true,   // Nutzer hat Spendenver√∂ffentlichung zugestimmt
      "anonymizeAmount": false  // Betrag darf gezeigt werden
    },
    "privacySettings": {
      "showInPublicLists": true,
      "allowExternalReferences": false,
      "retentionOverride": null // null = Standardaufbewahrung
    }
  },
  "meta": {
    "consentVerified": true,
    "requiredConsents": ["donation_public", "graph_public"]
  }
}
```

### 3.4 Erweiterte Event-Typen mit Datenschutz-Events

**Datenschutz-Events (privater Stream "wg.kleinroennau.privacy"):**
- `ConsentGiven{scopes[], policyVersion, granularSettings}` (Einwilligung erteilt)
- `ConsentWithdrawn{scopes[], reason}` (Einwilligung widerrufen)
- `ConsentUpdated{scopes[], changes[], reason}` (Einwilligung ge√§ndert)
- `DSR_AccessRequested{channel, requestedData[]}` (Auskunftsrecht)
- `DSR_DataExportReady{downloadUrl, expiresAt, includedData}` (Export bereit)
- `DSR_RectificationApplied{fields[], oldValues[], newValues[]}` (Berichtigung)
- `RolePseudonymizationRequested{reason}` (Pseudonymisierung angefordert)
- `RolePseudonymized{newDisplayName, removedData[], retainedData[]}` (Pseudonymisiert)
- `RoleTombstoned{reason}` (Konto stillgelegt - keine neuen Aktionen m√∂glich)
- `DSR_ErasureCompleted{method, deletedRecords, retainedRecords}` (L√∂schung abgeschlossen)

**Erweiterte Strukturknoten-Events:**
- `StrukturknotenInteraktionMitPrivacy{typ, interaktionstyp, privacySettings}`
- `GewebekontoTransaktionAnonymized{betragRange, approxTime}` (F√ºr anonyme Spenden)
- `WebratAbstimmungPseudonymized{result, participantCount}` (Pseudonyme Abstimmung)

**Erweiterte F√§den mit Privacy-Awareness:**
- `FadenGespannenMitEinwilligung{subtype, fromRolle, toKnoten, consentVerified}`
- `FadenAnonymisiert{fadenId, reason, retainedMetadata}`
- `FadenRetentionPolicyApplied{fadenId, policy, action}`

### 3.5 Privacy-aware Aktion‚ÜíEvent‚ÜíFaden‚ÜíRotation Mapping

| Benutzeraktion | Event(s) | Faden (wenn consent) | Webungs-Rotation | Privacy-Check | Strukturknoten |
|---|---|---|---|---|---|
| Kommentar in Raum | `FadenGespannenMitEinwilligung{gespr√§ch}` + `RolleWebtAktion` | Ja (graph_public) | **7s** (wenn graph_public) | ‚úì | ‚Üí N√§hst√ºbchen |
| **Einwilligung geben** | `ConsentGiven` | Nein | Nein | - | **Privacy System** |
| **Daten exportieren** | `DSR_AccessRequested` ‚Üí `DSR_DataExportReady` | Nein | Nein | - | **Privacy System** |
| **Rolle anonymisieren** | `RolePseudonymizationRequested` ‚Üí `RolePseudonymized` | Nein | Nein | - | **Privacy System** |
| **Spende (√∂ffentlich)** | `GoldfadenInitiated` + `FadenGespannenStrukturell{gold}` | Ja (donation_public) | **7s** | ‚úì donation_public | **‚Üí Gewebekonto** |
| **Spende (anonym)** | `GewebekontoTransaktionAnonymized` | Nein | Nein | ‚úì donation_public | **‚Üí Gewebekonto** |
| **Abstimmung** | `StimmeAbgegebenPseudonym` + `FadenGespannenStrukturell{abstimmung}` | Optional | **7s** | ‚úì | **‚Üí Webrat** |

***

## 4) System-Architektur & Implementation

### 4.1 Erweiterte System-√úbersicht mit Privacy-Layer & gestufter Architektur

```
[SvelteKit PWA + MapLibre + ServiceWorker + Dexie + Ed25519-Crypto + Privacy-Controls]
   ‚îÇ  HTTPS/WSS (TLS 1.3, CSP strict, No-Tracking Headers)
   ‚ñº
[NGINX + Varnish + Privacy-Headers] ‚îÄ‚îÄ‚Üí [Fastify API + Privacy-Middleware]
   ‚îÇ                                        ‚îÇ  Zod-Validation + Consent-Checking
   ‚îÇ                                        ‚îÇ  Auth: WebAuthn + Magic-Link + DSGVO-Compliance
   ‚îÇ                                        ‚îÇ  üÜï Privacy-Manager + Consent-Engine
   ‚îÇ                                        ‚îÇ  üÜï Pseudonymization-Service
   ‚îÇ                                        ‚ñº
   ‚îÇ                                [Enhanced EventBus mit Privacy-Streams]
   ‚îÇ                                  ‚îú‚îÄ‚Üí [NATS JetStream + Privacy-Subjects]
   ‚îÇ                                  ‚îî‚îÄ‚Üí [Redis + Privacy-Cache + Session-Store]
   ‚îÇ                                        ‚îÇ
   ‚îÇ                                        ‚îú‚îÄ‚Üí [Privacy-aware Projection Worker]
   ‚îÇ                                        ‚îÇ     ‚îî‚îÄ‚Üí [PostgreSQL + Separated PII Store]
   ‚îÇ                                        ‚îÇ
   ‚îÇ                                        ‚îî‚îÄ‚Üí [Enhanced Background Jobs]
   ‚îÇ                                              ‚îú‚îÄ‚Üí [Privacy-Compliance Worker]
   ‚îÇ                                              ‚îú‚îÄ‚Üí [Data-Export-Generator]
   ‚îÇ                                              ‚îú‚îÄ‚Üí [Pseudonymization-Processor]
   ‚îÇ                                              ‚îî‚îÄ‚Üí [Retention-Policy-Enforcer]
   ‚îÇ
   ‚îî‚îÄ‚Üí [Privacy-aware Monitoring Stack]
         ‚îú‚îÄ‚Üí [GDPR-Compliance-Dashboard]
         ‚îú‚îÄ‚Üí [Consent-Metrics & Audit-Logs]
         ‚îî‚îÄ‚Üí [Privacy-Incident-Alerting]
```

### 4.2 Privacy-Manager & Consent-Engine

```typescript
class PrivacyManager {
  private consentCache = new Map<string, ConsentState>();
  private pseudonymizationQueue = new Queue('pseudonymization');
  
  constructor(
    private eventBus: EventBus,
    private piiStore: PIIStore,
    private projectionManager: ProjectionManager
  ) {}
  
  async checkConsent(rolleId: string, requiredScopes: string[]): Promise<ConsentResult> {
    const cached = this.consentCache.get(rolleId);
    if (cached && !this.isExpired(cached)) {
      return this.evaluateConsent(cached, requiredScopes);
    }
    
    // Fresh consent lookup
    const consent = await this.loadConsentState(rolleId);
    this.consentCache.set(rolleId, consent);
    
    return this.evaluateConsent(consent, requiredScopes);
  }
  
  async processConsentUpdate(rolleId: string, newConsent: ConsentUpdate): Promise<void> {
    const oldConsent = await this.loadConsentState(rolleId);
    const changes = this.diffConsent(oldConsent, newConsent);
    
    // Event f√ºr Audit-Trail
    await this.eventBus.publish({
      type: changes.hasWithdrawals ? 'ConsentWithdrawn' : 'ConsentGiven',
      aggregateId: rolleId,
      subject: 'wg.kleinroennau.privacy',
      payload: {
        rolleId,
        scopes: changes.affectedScopes,
        policyVersion: newConsent.policyVersion,
        granularSettings: newConsent.granularSettings,
        reason: changes.reason
      },
      meta: {
        actor: rolleId,
        legalBasis: 'art6_1_a_gdpr',
        consentVersion: newConsent.policyVersion
      }
    });
    
    // Invalidate cache
    this.consentCache.delete(rolleId);
    
    // Trigger projection updates f√ºr ge√§nderte Sichtbarkeiten
    if (changes.hasWithdrawals) {
      await this.reprocessVisibilityProjections(rolleId, changes.withdrawnScopes);
    }
  }
  
  async requestPseudonymization(rolleId: string, reason: string): Promise<PseudonymizationResult> {
    const pseudoId = this.generatePseudoId();
    
    // Request-Event
    await this.eventBus.publish({
      type: 'RolePseudonymizationRequested',
      aggregateId: rolleId,
      subject: 'wg.kleinroennau.privacy',
      payload: { rolleId, reason, pseudoId },
      meta: { actor: rolleId, legalBasis: 'art17_gdpr' }
    });
    
    // Queue processing job
    await this.pseudonymizationQueue.add('process-pseudonymization', {
      rolleId,
      pseudoId,
      reason,
      requestedAt: new Date()
    });
    
    return { 
      pseudoId, 
      status: 'queued',
      estimatedCompletion: new Date(Date.now() + 15 * 60 * 1000) // 15 min
    };
  }
  
  private async processPseudonymization(job: PseudonymizationJob): Promise<void> {
    const { rolleId, pseudoId, reason } = job.data;
    
    // 1. Generate pseudo-identity
    const pseudoName = `Anonym-Rolle-${pseudoId.slice(0, 4).toUpperCase()}`;
    
    // 2. Remove PII mapping
    await this.piiStore.deletePII(rolleId);
    
    // 3. Update projections
    await this.projectionManager.pseudonymizeRole({
      rolleId,
      newDisplayName: pseudoName,
      avatar: 'anon',
      h3Resolution: Math.max(6, await this.getCurrentH3Resolution(rolleId)), // Generalize location
      anonymized: true
    });
    
    // 4. Completion event
    await this.eventBus.publish({
      type: 'RolePseudonymized',
      aggregateId: rolleId,
      subject: 'wg.kleinroennau.privacy',
      payload: {
        rolleId,
        newDisplayName: pseudoName,
        avatar: 'anon',
        geoMode: 'h3_generalized',
        h3Resolution: 6,
        linkToPII: 'removed',
        retainedData: ['graph_connections', 'governance_participation'],
        removedData: ['full_name', 'street', 'email', 'detailed_location'],
        reason
      },
      meta: {
        actor: 'system',
        legalBasis: 'art17_gdpr',
        auditRequired: true
      }
    });
  }
  
  async generateDataExport(rolleId: string, options: ExportOptions): Promise<ExportResult> {
    const exportId = generateULID();
    
    // Request-Event
    await this.eventBus.publish({
      type: 'DSR_AccessRequested',
      aggregateId: rolleId,
      subject: 'wg.kleinroennau.privacy',
      payload: { rolleId, channel: 'ui', exportId, options },
      meta: { actor: rolleId, legalBasis: 'art15_gdpr' }
    });
    
    // Collect data from various sources
    const exportData = await this.collectUserData(rolleId, options);
    
    // Generate secure download
    const downloadUrl = await this.secureFileService.createSignedExport({
      data: exportData,
      expiresIn: '7d',
      encryptFor: rolleId
    });
    
    // Ready-Event
    await this.eventBus.publish({
      type: 'DSR_DataExportReady',
      aggregateId: rolleId,
      subject: 'wg.kleinroennau.privacy',
      payload: {
        rolleId,
        exportId,
        downloadUrl,
        expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),
        format: options.format,
        includedData: options.includedData,
        sizeBytes: exportData.size
      }
    });
    
    return { exportId, downloadUrl, expiresAt: '7d' };
  }
}
```

### 4.3 Erweiterte Database Schema mit PII-Trennung & DSGVO-Compliance

```sql
-- Separater PII-Store (l√∂schbar/entkoppelbar)
CREATE TABLE personal_identity (
  rolle_id UUID PRIMARY KEY,
  full_name TEXT,
  street TEXT,
  zip TEXT,
  city TEXT,
  country TEXT,
  email TEXT,
  phone TEXT,
  birth_date DATE,
  created_at TIMESTAMPTZ DEFAULT now(),
  last_updated TIMESTAMPTZ DEFAULT now()
);

-- Versionierte Einwilligungen
CREATE TABLE consent_log (
  id BIGSERIAL PRIMARY KEY,
  rolle_id UUID NOT NULL,
  scope TEXT NOT NULL,                 -- 'profile_public', 'geo_public', etc.
  granted BOOLEAN NOT NULL,
  policy_version TEXT NOT NULL,
  granular_settings JSONB DEFAULT '{}',
  legal_basis TEXT DEFAULT 'art6_1_a_gdpr',
  at TIMESTAMPTZ DEFAULT now(),
  expires_at TIMESTAMPTZ,              -- Optional: befristete Einwilligungen
  withdrawn_at TIMESTAMPTZ,
  withdrawal_reason TEXT
);

-- DSGVO-Betroffenenrechte-Audit
CREATE TABLE dsr_audit (
  id BIGSERIAL PRIMARY KEY,
  rolle_id UUID,
  request_type TEXT NOT NULL,          -- access|export|rectification|erasure|restriction
  status TEXT NOT NULL,                -- requested|processing|completed|rejected
  requested_at TIMESTAMPTZ DEFAULT now(),
  completed_at TIMESTAMPTZ,
  processing_time_ms INTEGER,
  result_data JSONB,
  legal_basis TEXT,
  notes TEXT
);

-- Privacy-aware Rollenprojektion (was die Karte/APIs lesen)
CREATE TABLE role_projection (
  rolle_id UUID PRIMARY KEY,
  display_name TEXT NOT NULL,
  avatar TEXT,
  h3 BIGINT,                           -- Ggf. generalisiert f√ºr Anonymit√§t
  h3_resolution INT DEFAULT 9,         -- Original vs generalisiert
  anonymized BOOLEAN DEFAULT FALSE,
  tombstoned BOOLEAN DEFAULT FALSE,    -- Konto stillgelegt
  last_activity TIMESTAMPTZ,
  consent_status JSONB DEFAULT '{}',   -- Cached consent state f√ºr Performance
  privacy_level TEXT DEFAULT 'public', -- public|partial|anonymous
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- Erweiterte DSGVO-konforme Knoten-Tabelle
CREATE TABLE knoten (
  id UUID PRIMARY KEY,
  typ knoten_typ NOT NULL,
  title TEXT NOT NULL,
  content JSONB,
  coords GEOGRAPHY(POINT) NOT NULL,
  h3 BIGINT NOT NULL,
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  is_structural BOOLEAN DEFAULT FALSE,
  fade_started_at TIMESTAMPTZ,
  expires_at TIMESTAMPTZ,
  last_linked_at TIMESTAMPTZ,
  has_garn BOOLEAN DEFAULT FALSE,
  peer_signatures JSONB DEFAULT '[]',
  -- DSGVO-spezifische Felder
  privacy_impact JSONB DEFAULT '{}',   -- Welche personenbezogenen Daten sind betroffen
  consent_required BOOLEAN DEFAULT FALSE,
  retention_policy TEXT DEFAULT 'standard', -- standard|extended|minimal
  anonymization_safe BOOLEAN DEFAULT TRUE,  -- Kann bei Anonymisierung erhalten bleiben
  created_by_anonymized BOOLEAN DEFAULT FALSE -- Ersteller wurde anonymisiert
);

-- Erweiterte F√§den-Tabelle mit Privacy-Awareness
CREATE TABLE faeden (
  id UUID PRIMARY KEY,
  from_rolle UUID REFERENCES rollen(id) NOT NULL,
  to_knoten UUID REFERENCES knoten(id) NOT NULL,
  subtype faden_subtype NOT NULL,
  content TEXT,
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  expires_at TIMESTAMPTZ NOT NULL,
  is_garn BOOLEAN DEFAULT FALSE,
  is_structural_connection BOOLEAN DEFAULT FALSE,
  structural_type strukturknoten_typ,
  routing_metadata JSONB,
  peer_verified BOOLEAN DEFAULT FALSE,
  peer_signatures JSONB DEFAULT '[]',
  -- DSGVO-spezifische Felder
  privacy_level TEXT DEFAULT 'public', -- public|partial|anonymous
  consent_verified BOOLEAN DEFAULT FALSE,
  required_consents TEXT[] DEFAULT '{}',
  anonymized_at TIMESTAMPTZ,
  original_creator_anonymized BOOLEAN DEFAULT FALSE,
  retention_policy_override TEXT
);

-- Privacy-Events (separater Stream)
CREATE TABLE privacy_events (
  id UUID PRIMARY KEY,
  type TEXT NOT NULL,
  rolle_id UUID NOT NULL,
  ts TIMESTAMPTZ NOT NULL DEFAULT now(),
  payload JSONB NOT NULL,
  legal_basis TEXT,
  processing_purpose TEXT,
  retention_period INTERVAL
);

-- Pseudonymization-Mapping (f√ºr Audit-Zwecke, hochsicher)
CREATE TABLE pseudonym_audit (
  id BIGSERIAL PRIMARY KEY,
  original_rolle_id UUID NOT NULL,    -- Original (wird nach Retention gel√∂scht)
  pseudo_identifier TEXT NOT NULL,    -- "Anonym-Rolle-A7B2"
  pseudonymized_at TIMESTAMPTZ DEFAULT now(),
  reason TEXT,
  retained_data_types TEXT[],
  removed_data_types TEXT[],
  legal_basis TEXT DEFAULT 'art17_gdpr'
);

-- Performance-Indizes mit Privacy-Awareness
CREATE INDEX IF NOT EXISTS idx_role_projection_privacy ON role_projection(privacy_level, anonymized);
CREATE INDEX IF NOT EXISTS idx_faeden_privacy ON faeden(privacy_level, anonymized_at);
CREATE INDEX IF NOT EXISTS idx_consent_log_current ON consent_log(rolle_id, scope) WHERE withdrawn_at IS NULL;
CREATE INDEX IF NOT EXISTS idx_dsr_audit_processing ON dsr_audit(status, requested_at) WHERE status != 'completed';

-- Retention-Policy-Constraints
ALTER TABLE consent_log ADD CONSTRAINT consent_retention_check 
  CHECK (expires_at IS NULL OR expires_at > at);

-- Privacy-Level-Constraints  
ALTER TABLE role_projection ADD CONSTRAINT valid_privacy_level 
  CHECK (privacy_level IN ('public', 'partial', 'anonymous'));
```

### 4.4 Privacy-aware API-Endpoints mit DSGVO-Compliance

```typescript
// Privacy-Middleware f√ºr alle API-Calls
async function privacyMiddleware(req: FastifyRequest, reply: FastifyReply) {
  const rolleId = req.user?.rolleId;
  if (!rolleId) return; // Anonymous requests passieren durch
  
  // Check consent f√ºr API-Operation
  const requiredConsents = getRequiredConsents(req.method, req.routerPath);
  if (requiredConsents.length > 0) {
    const consentResult = await privacyManager.checkConsent(rolleId, requiredConsents);
    if (!consentResult.granted) {
      return reply.code(403).send({
        error: 'consent_required',
        requiredConsents,
        consentUrl: '/datenschutz',
        message: 'Diese Aktion erfordert deine Einwilligung.'
      });
    }
  }
  
  // Request-Logging mit Privacy-Compliance
  await logPrivacyCompliantRequest(req, {
    endpoint: req.routerPath,
    method: req.method,
    rolleId,
    ipHash: hashWithDailySalt(req.ip),
    userAgentHash: hashWithDailySalt(req.headers['user-agent']),
    consentVerified: true
  });
}

// GET /api/me/privacy - Datenschutz-Dashboard
app.get('/api/me/privacy', async (req, reply) => {
  const rolleId = req.user.rolleId;
  
  const [consentState, privacyEvents, exportHistory] = await Promise.all([
    privacyManager.getCurrentConsentState(rolleId),
    privacyManager.getPrivacyEventHistory(rolleId, { limit: 50 }),
    privacyManager.getExportHistory(rolleId)
  ]);
  
  reply.send({
    consentState,
    privacyLevel: derivePrivacyLevel(consentState),
    recentEvents: privacyEvents,
    exportHistory,
    dataRetentionInfo: await privacyManager.getRetentionInfo(rolleId),
    yourRights: {
      access: true,
      rectification: true,
      erasure: true, // Via Pseudonymization
      restriction: true,
      portability: true,
      objection: true
    }
  });
});

// POST /api/me/consent - Einwilligungen verwalten
app.post('/api/me/consent', async (req, reply) => {
  const { scopes, granularSettings, reason } = req.body;
  const rolleId = req.user.rolleId;
  
  // Validierung der Consent-Daten
  const validatedConsent = consentSchema.parse({
    scopes,
    granularSettings,
    policyVersion: CURRENT_POLICY_VERSION,
    reason
  });
  
  try {
    await privacyManager.processConsentUpdate(rolleId, validatedConsent);
    
    reply.send({
      success: true,
      newConsentState: await privacyManager.getCurrentConsentState(rolleId),
      message: 'Deine Einwilligungen wurden aktualisiert.'
    });
  } catch (error) {
    reply.code(500).send({
      error: 'consent_update_failed',
      message: 'Die Einwilligungen konnten nicht aktualisiert werden.'
    });
  }
});

// POST /api/me/export - Datenexport anfordern
app.post('/api/me/export', async (req, reply) => {
  const { format = 'json', includedData = {} } = req.body;
  const rolleId = req.user.rolleId;
  
  const exportOptions: ExportOptions = {
    format,
    includedData: {
      profile: includedData.profile ?? true,
      faeden: includedData.faeden ?? true,
      abstimmungen: includedData.abstimmungen ?? true,
      finanzen: includedData.finanzen ?? true,
      interactions: includedData.interactions ?? false
    }
  };
  
  try {
    const exportResult = await privacyManager.generateDataExport(rolleId, exportOptions);
    
    reply.send({
      success: true,
      exportId: exportResult.exportId,
      downloadUrl: exportResult.downloadUrl,
      expiresAt: exportResult.expiresAt,
      message: 'Dein Datenexport wird vorbereitet. Du erh√§ltst eine Benachrichtigung, sobald er bereit ist.'
    });
  } catch (error) {
    reply.code(500).send({
      error: 'export_failed',
      message: 'Der Datenexport konnte nicht erstellt werden.'
    });
  }
});

// POST /api/me/pseudonymize - Rolle anonymisieren
app.post('/api/me/pseudonymize', async (req, reply) => {
  const { reason = 'user_request', keepGraphConnections = true } = req.body;
  const rolleId = req.user.rolleId;
  
  // Best√§tigung erforderlich
  const confirmationToken = req.headers['x-confirmation-token'];
  if (!confirmationToken || !await verifyConfirmationToken(rolleId, confirmationToken)) {
    return reply.code(400).send({
      error: 'confirmation_required',
      message: 'Diese Aktion erfordert eine explizite Best√§tigung.',
      confirmationUrl: '/datenschutz/bestaetigung/pseudonymisierung'
    });
  }
  
  try {
    const result = await privacyManager.requestPseudonymization(rolleId, reason);
    
    reply.send({
      success: true,
      pseudoId: result.pseudoId,
      status: result.status,
      estimatedCompletion: result.estimatedCompletion,
      message: 'Deine Rolle wird anonymisiert. Du kannst die Weberei weiterhin nutzen, aber deine pers√∂nlichen Daten werden entfernt.',
      newDisplayName: `Anonym-Rolle-${result.pseudoId.slice(0, 4).toUpperCase()}`
    });
  } catch (error) {
    reply.code(500).send({
      error: 'pseudonymization_failed',
      message: 'Die Anonymisierung konnte nicht gestartet werden.'
    });
  }
});

// GET /api/knoten/:id (Privacy-aware)
app.get('/api/knoten/:id', async (req, reply) => {
  const { id } = req.params;
  const viewerRolleId = req.user?.rolleId;
  
  const knoten = await db.knoten.findUnique({
    where: { id },
    include: {
      faeden: {
        where: await buildPrivacyAwareWhere(viewerRolleId, 'faeden')
      },
      verzwirnungen: true,
      threads: {
        where: await buildPrivacyAwareWhere(viewerRolleId, 'threads')
      }
    }
  });
  
  if (!knoten) {
    return reply.code(404).send({ error: 'knoten_not_found' });
  }
  
  // Privacy-Filter anwenden
  const filteredKnoten = await applyPrivacyFilters(knoten, viewerRolleId);
  
  reply.send({
    ...filteredKnoten,
    privacyNotice: knoten.consent_required 
      ? 'Einige Inhalte sind nur mit entsprechenden Einwilligungen sichtbar.'
      : null
  });
});

async function buildPrivacyAwareWhere(viewerRolleId?: string, entity: string) {
  if (!viewerRolleId) {
    // Anonymous viewer: only public content
    return { privacy_level: 'public', anonymized_at: null };
  }
  
  // Authenticated viewer: own content + consented public content
  return {
    OR: [
      { from_rolle: viewerRolleId }, // Own content always visible
      { 
        AND: [
          { privacy_level: 'public' },
          { consent_verified: true }
        ]
      }
    ]
  };
}
```

***

## 5) Performance & Monitoring

### 5.1 Enhanced Prometheus Metriken mit Privacy & DSGVO-Compliance

```typescript
export const enhancedMetricsWithPrivacy = {
  // DSGVO-Compliance-Metriken
  consentOperations: new Counter({
    name: 'wg_consent_operations_total',
    help: 'DSGVO-Einwilligungsoperationen',
    labelNames: ['operation', 'scope', 'result'] // grant|withdraw|update
  }),
  
  dsrRequests: new Counter({
    name: 'wg_dsr_requests_total',
    help: 'DSGVO-Betroffenenrechte-Anfragen',
    labelNames: ['type', 'status'] // access|export|rectification|erasure
  }),
  
  dsrProcessingTime: new Histogram({
    name: 'wg_dsr_processing_duration_ms',
    help: 'Bearbeitungszeit f√ºr DSGVO-Anfragen',
    labelNames: ['type'],
    buckets: [1000, 5000, 15000, 30000, 60000, 300000] // bis 5 Minuten
  }),
  
  pseudonymizationOperations: new Counter({
    name: 'wg_pseudonymization_operations_total',
    help: 'Durchgef√ºhrte Pseudonymisierungen',
    labelNames: ['reason', 'success']
  }),
  
  privacyIncidents: new Counter({
    name: 'wg_privacy_incidents_total',
    help: 'Datenschutz-Vorf√§lle',
    labelNames: ['severity', 'type'] // info|warning|error
  }),
  
  consentCompliance: new Gauge({
    name: 'wg_consent_compliance_rate',
    help: 'Anteil der Nutzer mit g√ºltigen Einwilligungen (0-1)'
  }),
  
  dataRetentionCompliance: new Gauge({
    name: 'wg_data_retention_compliance_rate', 
    help: 'Anteil der Daten mit korrekter Aufbewahrungszeit (0-1)'
  }),
  
  // Privacy-aware Performance-Metriken
  privacyFilterLatency: new Histogram({
    name: 'wg_privacy_filter_latency_ms',
    help: 'Zeit f√ºr Privacy-Filter-Anwendung',
    buckets: [1, 5, 10, 25, 50, 100]
  }),
  
  consentCacheHitRate: new Gauge({
    name: 'wg_consent_cache_hit_rate',
    help: 'Cache-Trefferrate f√ºr Einwilligungspr√ºfungen (0-1)'
  }),
  
  // Erweiterte Strukturknoten-Metriken mit Privacy
  strukturknotenInteraktionenMitPrivacy: new Counter({
    name: 'wg_structural_interactions_privacy_total',
    help: 'Strukturknoten-Interaktionen nach Privacy-Level',
    labelNames: ['strukturknoten_typ', 'privacy_level']
  }),
  
  // Erweiterte Webungs-Rotation mit Privacy-Awareness
  webungsRotationenPrivacyAware: new Counter({
    name: 'wg_rotations_privacy_aware_total',
    help: 'Webungs-Rotationen nach Sichtbarkeitslevel',
    labelNames: ['privacy_level', 'consent_verified']
  }),
  
  // Erweiterte Governance-Metriken
  abstimmungenPseudonym: new Counter({
    name: 'wg_votes_pseudonymized_total',
    help: 'Pseudonyme Abstimmungen zum Datenschutz'
  }),
  
  // System-Performance mit Privacy
  piiSeparationLatency: new Histogram({
    name: 'wg_pii_separation_latency_ms',
    help: 'Zeit f√ºr PII-Trennung bei Operationen',
    buckets: [5, 10, 25, 50, 100, 250]
  }),
  
  // Kosten-Metriken (neu f√ºr gestufte Architektur)
  infrastructureCosts: new Gauge({
    name: 'wg_infrastructure_costs_eur_per_month',
    help: 'Monatliche Infrastrukturkosten in EUR',
    labelNames: ['phase', 'component'] // phase_a|phase_b|phase_c
  }),
  
  costPerEvent: new Gauge({
    name: 'wg_cost_per_1k_events_eur',
    help: 'Kosten pro 1000 Events in EUR (30-Tage-Durchschnitt)'
  }),
  
  resourceUtilization: new Gauge({
    name: 'wg_resource_utilization_percent',
    help: 'Ressourcenauslastung nach Komponente (0-100)',
    labelNames: ['resource', 'phase'] // cpu|memory|storage|network
  })
};
```

### 5.2 Erweiterte Alerting Rules mit DSGVO-Compliance & Kosten-Monitoring

```yaml
# enhanced-alerts-with-privacy.yml
groups:
- name: weltgewebe-privacy-compliance.rules
  rules:
  
  # DSGVO-Compliance-Alerts
  - alert: DSRAnfrageNichtBearbeitet
    expr: max_over_time(wg_dsr_processing_duration_ms[30d]) > 2592000000 # 30 Tage in ms
    for: 1h
    labels:
      severity: critical
    annotations:
      summary: "DSGVO-Betroffenenrechte-Anfrage √ºberf√§llig"
      description: "DSR-Anfrage seit √ºber 30 Tagen unbearbeitet"
      legal_requirement: "Art. 12 Abs. 3 DSGVO - max. 30 Tage Bearbeitungszeit"
      
  - alert: EinwilligungsrateNiedrig
    expr: wg_consent_compliance_rate < 0.8
    for: 2h
    labels:
      severity: warning
    annotations:
      summary: "Niedrige Einwilligungsrate"
      description: "Nur {{ $value | humanizePercentage }} der Nutzer haben g√ºltige Einwilligungen"
      
  - alert: DatenspeicherungNichtKonform
    expr: wg_data_retention_compliance_rate < 0.95
    for: 1h
    labels:
      severity: warning
    annotations:
      summary: "Datenaufbewahrung nicht vollst√§ndig konform"
      description: "{{ $value | humanizePercentage }} Compliance-Rate bei Datenaufbewahrung"
      
  - alert: PrivacyIncidentErkannt
    expr: increase(wg_privacy_incidents_total{severity="error"}[5m]) > 0
    for: 0s
    labels:
      severity: critical
    annotations:
      summary: "Datenschutz-Vorfall erkannt!"
      description: "Schwerwiegender Privacy-Incident aufgetreten"
      action_required: "Sofortige Untersuchung und Meldung an Datenschutzbeauftragten"
      
  - alert: PseudonymisierungFehlgeschlagen
    expr: rate(wg_pseudonymization_operations_total{success="false"}[1h]) > 0.1
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Pseudonymisierung schl√§gt h√§ufig fehl"
      description: "{{ $value }} Pseudonymisierungs-Fehler pro Sekunde"

  # Performance-Alerts mit Privacy-Awareness
  - alert: PrivacyFilterLangsam
    expr: histogram_quantile(0.95, wg_privacy_filter_latency_ms) > 100
    for: 10m
    labels:
      severity: warning
    annotations:
      summary: "Privacy-Filter verlangsamen System"
      description: "P95 Privacy-Filter-Latenz: {{ $value }}ms"
      
  - alert: ConsentCacheIneffizient
    expr: wg_consent_cache_hit_rate < 0.8
    for: 15m
    labels:
      severity: info
    annotations:
      summary: "Einwilligungs-Cache ineffizient"
      description: "Cache-Trefferrate: {{ $value | humanizePercentage }}"

  # Kosten-Alerts (neu)
  - alert: InfrastrukturkostenZuHoch
    expr: wg_infrastructure_costs_eur_per_month > 300
    for: 10m
    labels:
      severity: warning
    annotations:
      summary: "Infrastrukturkosten √ºberschreiten Budget"
      description: "Aktuelle Kosten: ‚Ç¨{{ $value }}/Monat"
      budget_phase_a: "‚Ç¨250/Monat"
      
  - alert: CostPerEventZuHoch
    expr: wg_cost_per_1k_events_eur > 0.015
    for: 30m
    labels:
      severity: warning
    annotations:
      summary: "Kosten pro Event zu hoch"
      description: "‚Ç¨{{ $value }} pro 1000 Events (Ziel: <‚Ç¨0,01)"
      
  - alert: RessourcenauslastungHoch
    expr: wg_resource_utilization_percent > 85
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Hohe Ressourcenauslastung"
      description: "{{ $labels.resource }} Auslastung: {{ $value }}%"
      scale_recommendation: "√úbergang zur n√§chsten Infrastruktur-Phase pr√ºfen"

  # Strukturknoten-Alerts mit Privacy
  - alert: StrukturknotenPrivacyVerletzung
    expr: increase(wg_structural_interactions_privacy_total{privacy_level="anonymous"}[1h]) == 0 and increase(wg_structural_interactions_privacy_total[1h]) > 100
    for: 30m
    labels:
      severity: info
    annotations:
      summary: "Strukturknoten: Keine anonymen Interaktionen"
      description: "Alle Strukturknoten-Interaktionen sind personalisiert - Privacy-Optionen bewerben"
```

***

## 6) Datenschutz & DSGVO-Konformit√§t

### 6.1 Rechtliche Grundlagen & Compliance-Framework

**Verarbeitungsgrundlagen (Art. 6 DSGVO):**
- **Art. 6 Abs. 1 lit. a**: Einwilligung f√ºr √∂ffentliche Sichtbarkeit (Profile, Geo-Daten, Vernetzung, Spenden)
- **Art. 6 Abs. 1 lit. f**: Berechtigtes Interesse f√ºr Systemfunktionalit√§t (Event-Logs, Peer-Verifikation, Systemsicherheit)
- **Art. 6 Abs. 1 lit. c**: Rechtliche Verpflichtung (Audit-Logs, Sicherheitsmonitoring)

**Besondere Kategorien (Art. 9 DSGVO):**
- **Politische Meinungen**: Abstimmungsverhalten wird pseudonymisiert verarbeitet
- **Geolokalisierung**: Nur mit ausdr√ºcklicher Einwilligung, generalisierbar auf H3-Level 6

### 6.2 Einwilligungsmanagement (Consent Management)

**Granulare Einwilligungsbereiche:**
```typescript
interface ConsentScopes {
  // Profil-Daten
  profile_public: {
    includes: ['name', 'avatar'];
    excludes: ['email', 'phone', 'birth_date'];
    description: 'Dein Name und Profilbild sind f√ºr andere sichtbar';
  };
  
  // Geografische Daten
  geo_public: {
    precision: 'h3_level_7' | 'h3_level_6'; // Genauigkeit w√§hlbar
    timeRestriction: 'always' | 'active_hours_only' | 'events_only';
    description: 'Deine ungef√§hre Position wird auf der Karte angezeigt';
  };
  
  // Vernetzung & Aktivit√§ten
  graph_public: {
    includes: ['faeden', 'knoten_interactions', 'webungs_rotations'];
    excludes: ['private_messages', 'draft_content'];
    description: 'Deine Verbindungen und Aktivit√§ten im Gewebe sind sichtbar';
  };
  
  // Finanzielle Transparenz
  donation_public: {
    showAmounts: boolean;
    showRecipients: boolean;
    anonymizeSmallAmounts: boolean; // <10‚Ç¨ automatisch anonym
    description: 'Deine Spenden sind f√ºr Transparenz sichtbar';
  };
  
  // Technische Daten
  analytics_min: {
    includes: ['performance_metrics', 'error_logs'];
    excludes: ['detailed_usage_patterns', 'cross_site_tracking'];
    description: 'Minimale technische Daten f√ºr Systemverbesserung';
  };
}
```

**Einwilligungs-UI-Komponente:**
```svelte
<div class="consent-manager">
  <h3>üîí Deine Privatsph√§re-Einstellungen</h3>
  <p class="intro">Bestimme genau, was von dir sichtbar ist. Alles ist optional und jederzeit √§nderbar.</p>
  
  {#each Object.entries(consentScopes) as [scope, config]}
    <div class="consent-scope">
      <div class="scope-header">
        <label class="consent-toggle">
          <input 
            type="checkbox" 
            bind:checked={userConsent[scope]} 
            on:change={() => updateConsent(scope)}
          />
          <span class="toggle-slider"></span>
        </label>
        <h4>{config.title}</h4>
      </div>
      
      <p class="scope-description">{config.description}</p>
      
      {#if config.granularOptions}
        <div class="granular-options" class:visible={userConsent[scope]}>
          {#each config.granularOptions as option}
            <label class="sub-option">
              <input 
                type="checkbox" 
                bind:checked={userConsent[`${scope}_${option.key}`]}
                disabled={!userConsent[scope]}
              />
              <span>{option.label}</span>
            </label>
          {/each}
        </div>
      {/if}
      
      <div class="scope-impact">
        <details>
          <summary>Was passiert mit diesen Daten?</summary>
          <div class="impact-details">
            <p><strong>Verwendung:</strong> {config.usage}</p>
            <p><strong>Sichtbarkeit:</strong> {config.visibility}</p>
            <p><strong>Aufbewahrung:</strong> {config.retention}</p>
            <p><strong>Deine Rechte:</strong> Jederzeit widerrufbar, exportierbar, berichtigbar</p>
          </div>
        </details>
      </div>
    </div>
  {/each}
  
  <div class="consent-actions">
    <button class="save-consent" on:click={saveConsentSettings}>
      Einstellungen speichern
    </button>
    <button class="export-data" on:click={requestDataExport}>
      üìÑ Alle Daten exportieren
    </button>
    <button class="anonymize-role" on:click={requestAnonymization}>
      üï∂Ô∏è Rolle anonymisieren
    </button>
  </div>
  
  <div class="legal-info">
    <p class="legal-basis">
      <strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. a DSGVO (Einwilligung)<br>
      <strong>Widerrufsrecht:</strong> Jederzeit ohne Angabe von Gr√ºnden<br>
      <strong>Kontakt:</strong> datenschutz@weltgewebe.net
    </p>
  </div>
</div>
```

### 6.3 Betroffenenrechte-Implementation

**Automatisierte Betroffenenrechte-API:**
```typescript
class DSRController {
  
  // Art. 15 DSGVO - Recht auf Auskunft
  async handleAccessRequest(rolleId: string): Promise<AccessResponse> {
    const userData = await this.collectAllUserData(rolleId);
    
    return {
      personalData: userData.profile,
      processingActivities: userData.activities,
      dataCategories: userData.categories,
      recipients: ['Peer-Network-Knoten', 'Backup-Services'],
      retentionPeriods: userData.retention,
      yourRights: {
        access: true,
        rectification: true,
        erasure: true, // Via Pseudonymization
        restriction: true,
        portability: true,
        objection: true
      },
      complaints: {
        authority: 'Datenschutzaufsichtsbeh√∂rde deines Bundeslandes',
        email: 'poststelle@lfd.niedersachsen.de' // Beispiel
      }
    };
  }
  
  // Art. 20 DSGVO - Recht auf Daten√ºbertragbarkeit  
  async handlePortabilityRequest(rolleId: string, format: 'json'|'csv'): Promise<PortabilityResponse> {
    const exportData = await this.generateStructuredExport(rolleId, format);
    const signedUrl = await this.secureFileService.createDownload(exportData);
    
    return {
      downloadUrl: signedUrl,
      format,
      dataStructure: this.getExportSchema(),
      expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),
      encryption: 'AES-256-GCM',
      integrity: 'SHA-256 checksum included'
    };
  }
  
  // Art. 16 DSGVO - Recht auf Berichtigung
  async handleRectificationRequest(rolleId: string, corrections: RectificationData): Promise<void> {
    // Validiere Berichtigungen
    const validatedCorrections = this.validateRectifications(corrections);
    
    // Erstelle Berichtigungs-Events
    for (const [field, newValue] of Object.entries(validatedCorrections)) {
      await this.eventBus.publish({
        type: 'DSR_RectificationApplied',
        aggregateId: rolleId,
        subject: 'wg.kleinroennau.privacy',
        payload: {
          field,
          oldValue: await this.getCurrentValue(rolleId, field),
          newValue,
          reason: 'user_rectification_request'
        },
        meta: {
          actor: rolleId,
          legalBasis: 'art16_gdpr'
        }
      });
    }
    
    // Update Projektionen
    await this.projectionManager.applyRectifications(rolleId, validatedCorrections);
  }
  
  // Art. 17 DSGVO - Recht auf L√∂schung (via Pseudonymization)
  async handleErasureRequest(rolleId: string, reason: string): Promise<ErasureResponse> {
    // Weltgewebe-spezifisch: Pseudonymization statt vollst√§ndiger L√∂schung
    // um die Integrit√§t des Gewebes zu erhalten
    
    const pseudoResult = await this.privacyManager.requestPseudonymization(rolleId, reason);
    
    return {
      method: 'pseudonymization',
      rationale: 'Erhaltung der Integrit√§t des kollektiven Gewebes bei vollst√§ndigem Schutz der Privatsph√§re',
      pseudoIdentifier: pseudoResult.pseudoId,
      dataRemoved: [
        'Vollst√§ndiger Name',
        'E-Mail-Adresse', 
        'Pr√§zise Geolokalisierung',
        'Verkn√ºpfung zu externen Identit√§ten'
      ],
      dataRetained: [
        'Anonymisierte Beitr√§ge zum Gewebe',
        'Pseudonyme Governance-Teilnahme',
        'Generalisierte Geolokalisierung (H3-Level 6)'
      ],
      effectiveDate: new Date(),
      reversibility: false,
      auditTrail: `DSR-${pseudoResult.pseudoId}`
    };
  }
}
```

### 6.4 Privacy-by-Design Implementierung

**Technische und organisatorische Ma√ünahmen (TOM):**

```typescript
class PrivacyByDesignController {
  
  // Data Minimization - Art. 5 Abs. 1 lit. c DSGVO
  async enforceDataMinimization() {
    return {
      collection: 'Nur explizit ben√∂tigte Daten werden erhoben',
      processing: 'Verarbeitung erfolgt nur f√ºr angegebene Zwecke',
      retention: 'Automatische L√∂schung nach Zweckerf√ºllung',
      access: 'Zugriff nur mit entsprechender Berechtigung'
    };
  }
  
  // Storage Limitation - Art. 5 Abs. 1 lit. e DSGVO
  async enforceRetentionPolicies() {
    const policies = {
      'events': '7 Jahre (gesetzliche Aufbewahrungspflicht)',
      'personal_data': 'Bis zur Anonymisierung/L√∂schung',
      'consent_logs': '3 Jahre nach Widerruf',
      'audit_logs': '6 Jahre (Compliance)',
      'session_data': '30 Tage',
      'temp_exports': '7 Tage'
    };
    
    // Automated enforcement
    for (const [dataType, policy] of Object.entries(policies)) {
      await this.scheduleRetentionEnforcement(dataType, policy);
    }
  }
  
  // Pseudonymization - Art. 4 Nr. 5 DSGVO
  getPseudonymizationStrategy(): PseudonymizationStrategy {
    return {
      method: 'k-anonymity',
      parameters: {
        k: 5, // Mindestens 5 Personen pro Gruppe
        l_diversity: 2, // Mindestens 2 verschiedene sensitive Werte
        t_closeness: 0.2 // Verteilungs√§hnlichkeit
      },
      implementation: {
        names: 'Anonym-Rolle-{ULID-Prefix}',
        locations: 'H3-Generalisierung auf Level 6',
        timestamps: 'Rounding auf Stunden-Granularit√§t',
        amounts: 'Bereichsangaben statt Exaktwerte'
      },
      reversibility: false,
      auditability: true
    };
  }
}
```

### 6.5 Datenschutz-Monitoring & Incident Response

**Kontinuierliches Compliance-Monitoring:**
```typescript
class PrivacyComplianceMonitor {
  
  async runDailyComplianceCheck(): Promise<ComplianceReport> {
    const checks = await Promise.all([
      this.checkConsentValidity(),
      this.checkDataRetention(),
      this.checkAccessControls(),
      this.checkPseudonymizationIntegrity(),
      this.checkAuditLogCompleteness()
    ]);
    
    const report: ComplianceReport = {
      timestamp: new Date(),
      overallScore: this.calculateComplianceScore(checks),
      checks,
      issues: checks.filter(c => !c.passed),
      recommendations: this.generateRecommendations(checks)
    };
    
    if (report.overallScore < 0.95) {
      await this.triggerComplianceAlert(report);
    }
    
    return report;
  }
  
  async handlePrivacyIncident(incident: PrivacyIncident): Promise<IncidentResponse> {
    // Automatische Incident-Response nach Art. 33/34 DSGVO
    
    const severity = this.assessIncidentSeverity(incident);
    const response: IncidentResponse = {
      incidentId: generateULID(),
      severity,
      detectedAt: new Date(),
      affectedDataSubjects: await this.identifyAffectedUsers(incident),
      containmentActions: await this.executeContainment(incident),
      notificationRequired: severity >= 'high',
      reportingDeadline: severity >= 'high' 
        ? new Date(Date.now() + 72 * 60 * 60 * 1000) // 72h f√ºr Beh√∂rde
        : null
    };
    
    if (response.notificationRequired) {
      await this.notifyDataProtectionAuthority(response);
      if (severity === 'critical') {
        await this.notifyAffectedDataSubjects(response);
      }
    }
    
    return response;
  }
}
```

***

## 7) Kosten- & Infrastrukturstrategie

### 7.1 Gestufte Architektur f√ºr optimale Kosteneffizienz

**Strategisches Ziel:** <‚Ç¨0,01 pro 1.000 Events bei schrittweiser Skalierung

### 7.2 Phase A: Minimal Viable Product (0-6 Monate, ‚Ç¨90-250/Monat)

**Infrastruktur-Setup:**
```yaml
# Phase A - Single-Server-Setup
server:
  provider: "Hetzner Dedicated"
  specs:
    cpu: "AMD Ryzen 7 3700X (8 cores)"
    ram: "64 GB DDR4"
    storage: "2x 1TB NVMe SSD (RAID 1)"
    network: "1 Gbit/s unmetered"
  cost: "‚Ç¨89/month"

services:
  - postgresql: "Primary + Backup"
  - nats_jetstream: "Single node"
  - redis: "Cache + Sessions"
  - fastify_api: "Single instance"
  - nginx: "Reverse proxy + SSL"

monitoring:
  basic:
    - netdata: "‚Ç¨0 (self-hosted)"
    - healthchecks_io: "‚Ç¨7/month"
  advanced: false # Kein Prometheus/Grafana Stack

domains:
  - primary: "weltgewebe.net - ‚Ç¨12/year"
  - ssl: "Let's Encrypt - ‚Ç¨0"

payment_processing:
  manual: "SEPA transfers - ‚Ç¨0"
  api: false # Keine automatische Zahlungs-APIs

total_monthly_cost: "‚Ç¨90-120"
target_capacity: "50-200 aktive Nutzer"
events_per_month: "100k-500k"
cost_per_1k_events: "‚Ç¨0.18-‚Ç¨1.20"
```

**Phase A - Vereinfachungen:**
- **Peer-Network simuliert**: Technisch implementiert, aber Single-Node
- **Minimal-Monitoring**: Basis-Healthchecks, kein vollst√§ndiges Observability
- **Manuelle Zahlungen**: SEPA-√úberweisungen ohne API-Integration
- **Simplified Backup**: Daily PostgreSQL dumps, kein distributed backup

```typescript
// Phase A - Cost-Optimized Configuration
const phaseAConfig = {
  database: {
    poolSize: 10, // Reduziert f√ºr Single-Server
    connectionTimeout: 5000,
    backupStrategy: 'daily_pg_dump'
  },
  
  eventStore: {
    natsCluster: false, // Single NATS node
    replication: 1,
    retention: '30d' // K√ºrzer f√ºr Kosteneinsparung
  },
  
  monitoring: {
    prometheus: false,
    grafana: false,
    basicHealthchecks: true,
    alerting: 'simple_webhook'
  },
  
  peerNetwork: {
    enabled: false, // Simuliert in Single-Node
    consensusRequired: false
  }
};
```

### 7.3 Phase B: Hybrid Bootstrap (6-12 Monate, ‚Ç¨250-600/Monat)

**Erweiterte Infrastruktur:**
```yaml
# Phase B - Hybrid Multi-Node
primary_server:
  provider: "Hetzner Dedicated"
  specs:
    cpu: "AMD Ryzen 9 5900X (12 cores)"
    ram: "128 GB DDR4"  
    storage: "2x 2TB NVMe SSD (RAID 1)"
  cost: "‚Ç¨149/month"

peer_nodes:
  community_servers:
    count: 2-3
    specs: "4-8 GB RAM, 100-500 GB SSD"
    providers: "Community VPS, Vereine"
    cost: "‚Ç¨15-30/month each"
  
  light_peers:
    count: 5-10
    purpose: "Validation witnesses ohne full data"
    specs: "2 GB RAM, 50 GB SSD"
    cost: "‚Ç¨5-10/month each"

services_enhanced:
  - postgresql_ha: "Primary + Replica"
  - nats_cluster: "3-node JetStream cluster"
  - redis_cluster: "Master + Replica"
  - monitoring_stack: "Prometheus + Grafana"
  - backup_system: "Automated + S3-compatible"

automation:
  - aiops_scripts: "Log analysis, auto-restart"
  - automated_scaling: "Basic horizontal scaling"
  - alert_management: "Matrix/Signal webhooks"

payment_processing:
  - stripe_integration: "‚Ç¨0.25 + 1.4% per transaction"
  - sepa_direct_debit: "‚Ç¨0.35 per transaction"

total_monthly_cost: "‚Ç¨250-600 (community-verteilt)"
target_capacity: "200-1000 aktive Nutzer"
events_per_month: "500k-2M"
cost_per_1k_events: "‚Ç¨0.125-‚Ç¨1.20"
```

**Phase B - Peer-Network-Integration:**
```typescript
// Phase B - Light Peer Implementation
class LightPeer {
  constructor(
    private nodeId: string,
    private capabilities: PeerCapabilities
  ) {}
  
  // Light peers validieren Events, speichern aber keine vollst√§ndigen Daten
  async validateEvent(event: WeltgewebeEvent): Promise<ValidationResult> {
    const checks = await Promise.all([
      this.validateSchema(event),
      this.validateSignature(event),
      this.validateBusinessLogic(event)
    ]);
    
    return {
      peerId: this.nodeId,
      eventId: event.id,
      valid: checks.every(c => c.valid),
      checks,
      timestamp: new Date(),
      signature: await this.signValidation(event.id, checks)
    };
  }
  
  // Kosteneffizienz: Keine vollst√§ndige Datenhaltung
  getStorageRequirements(): StorageRequirements {
    return {
      events: false, // Nur Hashes f√ºr Validation
      projections: false, // Keine lokalen Projektionen
      peerState: true, // Peer-Network-Status
      validationHistory: true, // Eigene Validierungen
      estimatedSize: '< 10 GB' // Sehr kompakt
    };
  }
}
```

### 7.4 Phase C: Progressive Dezentralisierung (12+ Monate, ‚Ç¨600-2000/Monat)

**Vollst√§ndig verteilte Architektur:**
```yaml
# Phase C - Full Decentralization
federation_network:
  full_nodes:
    count: 8-15
    distribution: "Vereine, Partner, Community"
    specs: "16-32 GB RAM, 1-2 TB SSD"
    cost_per_node: "‚Ç¨50-150/month"
  
  light_nodes:
    count: 50+
    purpose: "Edge validation, regional presence"
    specs: "4 GB RAM, 200 GB SSD"
    cost_per_node: "‚Ç¨10-25/month"

consensus_mechanism:
  type: "Byzantine Fault Tolerant"
  algorithm: "PBFT with Ed25519"
  finality_time: "< 5 seconds"
  fault_tolerance: "33% malicious nodes"

data_distribution:
  sharding: "Geographic H3-based sharding"
  replication: "3x across different operators"
  archival: "S3-compatible cold storage"
  backup: "Distributed across federation"

advanced_features:
  - cross_federation_governance: "F√∂derierte Abstimmungen"
  - economic_incentives: "Staking/Delegation rewards"
  - advanced_privacy: "Zero-knowledge proofs f√ºr sensitive data"
  - mobile_peers: "Smartphone-based light nodes"

cost_distribution:
  total_network: "‚Ç¨2000-5000/month"
  per_operator: "‚Ç¨50-200/month"
  cost_sharing: "Community-finanziert + Donations"
  sustainability: "Gewebekonto-finanzierte Infrastruktur"

target_capacity: "5000+ aktive Nutzer"
events_per_month: "5M+"
cost_per_1k_events: "‚Ç¨0.003-‚Ç¨0.008" # Ziel erreicht!
```

### 7.5 Kosten-Monitoring & Optimierung

**Real-time Cost Tracking:**
```typescript
class CostMonitoringService {
  private costMetrics = new Map<string, CostMetric>();
  
  async trackInfrastructureCosts(): Promise<CostReport> {
    const costs = await Promise.all([
      this.getServerCosts(),
      this.getNetworkCosts(), 
      this.getStorageCosts(),
      this.getMonitoringCosts(),
      this.getPaymentProcessingCosts()
    ]);
    
    const totalMonthlyCost = costs.reduce((sum, cost) => sum + cost.amount, 0);
    const eventsThisMonth = await this.getEventCountThisMonth();
    const costPer1kEvents = (totalMonthlyCost / eventsThisMonth) * 1000;
    
    const report: CostReport = {
      timestamp: new Date(),
      totalMonthlyCost,
      eventsThisMonth,
      costPer1kEvents,
      breakdown: costs,
      phase: this.getCurrentPhase(),
      efficiency: this.calculateCostEfficiency(costPer1kEvents),
      recommendations: await this.generateCostOptimizations()
    };
    
    // Alert bei Kosten√ºberschreitung
    if (costPer1kEvents > this.getTargetCost()) {
      await this.triggerCostAlert(report);
    }
    
    return report;
  }
  
  async optimizeCosts(): Promise<OptimizationResult> {
    const current = await this.getCurrentCostStructure();
    const optimizations = [
      await this.optimizeStorageUsage(),
      await this.optimizeComputeResources(),
      await this.optimizeNetworkTraffic(),
      await this.optimizeRetentionPolicies()
    ];
    
    return {
      currentCosts: current,
      potentialSavings: optimizations.reduce((sum, opt) => sum + opt.savings, 0),
      optimizations,
      implementationComplexity: this.assessComplexity(optimizations),
      roi: this.calculateROI(optimizations)
    };
  }
  
  private getTargetCost(): number {
    const phase = this.getCurrentPhase();
    return {
      'phase_a': 0.20, // ‚Ç¨0.20 per 1k events
      'phase_b': 0.05, // ‚Ç¨0.05 per 1k events  
      'phase_c': 0.01  // ‚Ç¨0.01 per 1k events (Ziel)
    }[phase] || 0.01;
  }
}
```

**Automatische Skalierungs-Triggers:**
```typescript
class ScalingDecisionEngine {
  
  async evaluatePhaseTransition(): Promise<ScalingRecommendation> {
    const metrics = await this.collectScalingMetrics();
    
    const recommendation = {
      currentPhase: metrics.currentPhase,
      recommendedPhase: this.calculateOptimalPhase(metrics),
      triggers: this.getActiveTriggers(metrics),
      costImpact: await this.projectCostImpact(metrics),
      timeline: this.estimateTransitionTime(metrics),
      risks: this.assessTransitionRisks(metrics)
    };
    
    return recommendation;
  }
  
  private calculateOptimalPhase(metrics: ScalingMetrics): InfrastructurePhase {
    // Decision matrix basierend auf Nutzung und Kosten
    if (metrics.activeUsers > 1000 && metrics.costPer1kEvents > 0.05) {
      return 'phase_c'; // Skalierung zu Phase C lohnt sich
    }
    
    if (metrics.activeUsers > 200 && metrics.serverUtilization > 0.8) {
      return 'phase_b'; // Verteilung notwendig
    }
    
    return 'phase_a'; // Bleibe bei Single-Server
  }
}
```

***

## 8) Implementierungsplan & Phasen

### 8.1 Phase A: Vollst√§ndige Lokale Weberei mit DSGVO & Kostenoptimierung (0-12 Wochen)

**Sprint 1-2: DSGVO-konforme Basis-Architektur (Wochen 1-2)**
- ‚úÖ PII-Trennung im Database-Schema implementieren
- ‚úÖ Privacy-Manager & Consent-Engine entwickeln
- ‚úÖ Basis-Datenschutz-Events definieren und implementieren
- ‚úÖ Kostenoptimierte Single-Server-Architektur aufsetzen

**Sprint 3-4: Strukturknoten-Fundament mit Privacy-Integration (Wochen 3-4)**
- ‚úÖ Strukturknoten-Typen (Gewebekonto, Webrat, N√§hst√ºbchen) als permanente Kartenelemente
- ‚úÖ Privacy-aware Event-Schema mit strukturellen Flags
- ‚úÖ Database-Migration f√ºr Strukturknoten + DSGVO-Compliance
- ‚úÖ Strukturknoten-spezifische API-Endpoints mit Consent-Checking

**Sprint 5-6: Peer-Verifikation & Ed25519 mit Privacy-by-Design (Wochen 5-6)**
- ‚úÖ Ed25519-Signatur-Integration in Event-System mit Privacy-Subjects  
- ‚úÖ Simuliertes Peer-Consensus-System (Phase A - Single Node)
- ‚úÖ Privacy-Network-Tabellen und DSGVO-konforme API-Endpunkte
- ‚úÖ WebAuthn-Integration mit Ed25519-Support und Consent-Flow

**Sprint 7-8: Direkte Demokratie mit Datenschutz-Wahrung (Wochen 7-8)**
- ‚úÖ Sofortige Abstimmungsaktivierung nach Einspruch (0ms Latenz!)
- ‚úÖ Pseudonyme Abstimmungen f√ºr Privacy-Schutz
- ‚úÖ Webrat-Integration mit DSGVO-konformen Governance-Workflows
- ‚úÖ Enhanced Governance-UI mit Datenschutz-Controls

**Sprint 9-10: Erweiterte UX mit Privacy-Dashboard (Wochen 9-10)**
- ‚úÖ Strukturknoten-aware Webungs-Rotation (9s f√ºr strukturelle Aktionen)
- ‚úÖ Progressive Mehrfachf√§den-√úberlappung mit Privacy-Filtern
- ‚úÖ Zentrales Datenschutz & Sichtbarkeits-Dashboard
- ‚úÖ Privacy-aware MapLibre-Performance-Optimierungen

**Sprint 11-12: Integration, Testing & Polish (Wochen 11-12)**
- ‚úÖ DSGVO-Betroffenenrechte vollst√§ndig automatisiert (Export, Pseudonymization, etc.)
- ‚úÖ Kosten-Monitoring-Dashboard mit Echtzeit-Tracking
- ‚úÖ Vollst√§ndige A11y-Integration mit Privacy-Awareness
- ‚úÖ Enhanced E2E-Tests f√ºr alle Privacy- und Cost-Features

**Phase A - Qualit√§ts-Gates:**
- **DSGVO-Compliance**: Vollst√§ndige Betroffenenrechte, Consent-Management, PII-Trennung
- **Strukturknoten**: Permanente Sichtbarkeit, spezifische Privacy-aware Interaktions-UIs
- **Kosten**: ‚Ç¨90-250/Monat, <‚Ç¨0.20/1000 Events
- **Peer-Verifikation**: <100ms Ed25519-Verifikation (simuliert)
- **Direkte Demokratie**: 0ms Latenz von Einspruch zu Abstimmungsstart
- **Webungs-Rotation**: <50ms WebSocket-Latenz, korrekte 9s-Dauer f√ºr Strukturknoten
- **Privacy**: Granulare Einwilligungen, Pseudonymization-Pipeline, DSR-Automation

### 8.2 Phase B: Resilienz, Kosten-Optimierung & Community-Verteilung (13-20 Wochen)

**Enhanced Features mit Community-Finanzierung:**
- NATS 3-Node-Cluster mit Leafnodes f√ºr Community-Peer-Integration
- PostgreSQL High-Availability mit Community-Peer-Replikation
- WebPush-Benachrichtigungen (DSGVO-konform, opt-in, strukturknoten-spezifisch filterbar)
- Light-Peer-System: Community-VPS als Validierungs-Zeugen
- Transitive Delegationen mit Webrat-Integration und Privacy-Schutz
- Automated Cost-Optimization mit Community-Load-Balancing
- Enhanced Privacy-Features: Erweiterte Pseudonymization, k-Anonymity

**Phase B - Ziele:**
- **Kosten**: ‚Ç¨250-600/Monat (community-verteilt), <‚Ç¨0.05/1000 Events
- **Skalierung**: 200-1000 aktive Nutzer
- **Community-Engagement**: 2-3 Community-Server als Light-Peers
- **Privacy-Enhancement**: Zero-Knowledge-Proofs f√ºr sensitive Governance-Daten

### 8.3 Phase C: F√∂derierte Peer-Democracy & Kostenziel-Erreichung (21-32 Wochen)

**Vollst√§ndig verteilte Peer-Network-Produktion:**
- Produktive Leafnode-F√∂deration mit Ed25519-Mutual-Auth
- Cross-Federation-Strukturknoten-Synchronisation mit Privacy-Preservation
- F√∂derierte Peer-Verifikation mit global verteilten, DSGVO-konformen Peers
- DNS-SRV-Discovery f√ºr Peer-Network (`_peers._tcp.weltgewebe.net`)
- F√∂derierte Webrat-Abstimmungen √ºber Instanz-Grenzen mit pseudonymer Teilnahme
- Cross-Instance Gewebekonto-Transaktionen mit Privacy-by-Design
- Vollst√§ndige Dezentralisierung der Kostenstruktur

**Phase C - Skalierungs-Ziele:**
- **Nutzer**: 5000+ gleichzeitige Nutzer √ºber f√∂deriertes Netzwerk
- **Performance**: <500ms Cross-Federation-Latenz, 99.9% Uptime
- **Kosten**: <‚Ç¨0.01/1000 Events (Ziel erreicht!), community-finanziert
- **Privacy**: 99.9% Byzantine-Konsistenz-Rate mit vollst√§ndiger DSGVO-Compliance
- **Sustainability**: Selbstfinanzierung durch Gewebekonto-Umlagen und Community-Beitr√§ge

***

## 9) Schlusswort & Vision

### 9.1 Revolution√§re Neuerungen v14.4

**üîí DSGVO-Compliance by Design**: Vollst√§ndig integriertes Datenschutz-Management mit granularen Einwilligungen, automatisierten Betroffenenrechten und Privacy-by-Design-Architektur schafft vertrauensvolle und rechtssichere Teilhabe.

**üí∞ Gestufte Kostenarchitektur**: Der Drei-Phasen-Ansatz (‚Ç¨90-250 ‚Üí ‚Ç¨250-600 ‚Üí community-finanziert) erm√∂glicht nachhaltiges Wachstum von lokaler Initiative bis globales Peer-Netzwerk. 
Mit diesem Kostenmodell gewinnt die Weltweberei die notwendige Flexibilit√§t: Sie startet pragmatisch mit minimalen Mitteln, wahrt ihre Prinzipien der Transparenz und Ereignisbasiertheit und w√§chst organisch in Richtung einer robusten, dezentralen Infrastruktur. Die √úbergangsphase der Zentralisierung ist bewusst begrenzt ‚Äì getragen vom Kernteam und sp√§ter von den Gemeinschaftskonten. So verbindet sich finanzielle Realisierbarkeit mit der ethischen Vision: ein lebendiger Organismus, der sich selbst tr√§gt und Schritt f√ºr Schritt seine volle Autonomie entfaltet.


