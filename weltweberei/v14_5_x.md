# üåê Weltgewebe v14.5 ‚Äî Vollst√§ndige Blaupause mit radikaler Sichtbarkeit, freiwilliger Teilnahme 

## 0) Leitplanken & Prinzipien (unverhandelbar)

**Philosophische Grundlagen:**
- **Alles ist Event**: Append-only, unver√§nderlich; Hash-Kette pro Aggregat mit ed25519-Signaturen f√ºr Byzantine-tolerante Konsistenz
- **Radikale Sichtbarkeit als Kernprinzip**: Jede Teilnahme bedeutet bewusste, informierte Entscheidung f√ºr dauerhafte Transparenz aller Aktionen
- **Freiwilligkeit √ºber alles**: Niemand wird zur Teilnahme gedr√§ngt. Vollst√§ndige Aufkl√§rung vor Beitritt √ºber alle Konsequenzen
- **Sichtbarkeit ist aktionsbezogen**: Rollen rotieren 7 Sekunden nach jeder Webungsaktion (Edit, Faden, Antrag, Verzwirnen, Entzwirnen, Spende)
- **Fadenpflicht**: Jede aktive Nutzeraktion an einem Karten-Knoten erzeugt automatisch einen Faden von dessen Rolle zum Handlungsort (Subtyp je Aktion)
- **Strukturknoten als Ankerpunkte**: Gewebekonto, Webrat und N√§hst√ºbchen sind permanente, fixierte Kartenelemente mit spezieller Semantik
- **Sichtbarkeit ist W√§hrung**: Sichtbares Engagement, Ressourcen und Spenden bilden den Wert. Passive Betrachtung bleibt neutral
- **Peer-Verifikation & Autonomie**: Ed25519-signierte Events, Byzantine-tolerante Konsistenz
- **Global skalierbar**: Von Nachbarschaft bis weltweites Myzel mit R√ºckrufbarkeit aller Delegierten

**Technische Leitplanken:**
- **Small-Team-Ops**: 1-2 Personen betreibbar, MTTR ‚â§15 min, automatisierte Runbooks, Healthchecks (/health/live, /health/ready)
- **Gestufte Kostenarchitektur**: Phase A <‚Ç¨250/Monat, Phase B <‚Ç¨600/Monat, Phase C community-finanziert
- **Kosteneffizienz**: Ziel <‚Ç¨0,01/1.000 Events; Echtzeit-Kosten-Metrik im Dashboard
- **JetStream-Kern mit Peer-Network**: NATS JetStream als unverr√ºckbarer Event-Backbone, Redis f√ºr Fallback & Speed-Layer, Leafnodes f√ºr F√∂deration
- **Community-First**: Phase A liefert vollst√§ndige lokale Weberei-Erfahrung ab Tag 1

**Visualsprache:**
- **Faden** = verg√§nglich (7-Tage Fade), farbkodiert nach Subtyp
- **Garn** = verzwirnte F√§den (permanent, sichtbar verzwirnt), sch√ºtzt Knoten vor Verfall
- **Goldfaden** = Spenden (Finanzfluss, goldfarbig)
- **Strukturknoten** = Gewebekonto (gold), Webrat (rot), N√§hst√ºbchen (blau) als permanente Kartenelemente
- **Mehrfachf√§den** = intelligente √úberlappung bei mehreren F√§den zwischen gleichen Punkten
- **Webungs-Rotation** = 7s-Drehung der Garnrolle nach jeder Webungsaktion (global sichtbar)


***

## 1) UX & Informationsarchitektur

### 1.1 Karten-Zentralansicht (MapLibre GL) mit radikaler Transparenz

**Standardzustand:** Vollbild-Karte mit mobile-first Design und vollst√§ndiger Sichtbarkeit aller aktiven Teilnehmenden.

**Strukturknoten (immer sichtbar, nie verfallend):**
- **Gewebekonto** (goldenes Kassensymbol): Zentraler Finanzknoten f√ºr alle Goldfaden-Str√∂me
- **Webrat** (rotes Parlamentssymbol): Governance-Hub f√ºr Antr√§ge und Abstimmungen  
- **N√§hst√ºbchen** (blaues Kommunikationssymbol): Ortsunabh√§ngiger Diskussions-Raum

**Pull-Tabs (ausziehbare Drawer):**
- **Links**: "Webrat & N√§hst√ºbchen" (360px desktop, modal mobile)
  - **Integrierter Governance- und Chat-Bereich** verkn√ºpft mit Strukturknoten
  - Thread-Liste (pinnable, zuletzt aktiv), Rich-Text Editor
  - Live-Abstimmungs-Interface f√ºr sofortige Partizipation
- **Rechts**: "Filter & Ebenen" (300px desktop)
  - Toggles: Knotenarten, Zeitfenster (24h/7d/Snapshots), Delegationen, Goldf√§den, Governance-Marker
  - **Fadenarten-Filter**: Erweiterte Toggles f√ºr jeden Subtyp (Gespr√§ch, Gestaltung, Ver√§nderung, Antrag, Abstimmung, Gold, Delegation)
  - **Mehrfachf√§den-Toggle**: Ein/Aus f√ºr √ºberlappende Darstellung mit progressiver √úberlappungslogik
  - **Strukturknoten-Filter**: Spezielle Kontrollen f√ºr Gewebekonto/Webrat/N√§hst√ºbchen-Verbindungen
  - Fadenarten-Legende (farbkodiert), H3-Aufl√∂sung adaptiv zu Zoom-Level
- **Oben Mitte**: "Gewebekonto-Visualisierung" (verkn√ºpft mit Strukturknoten)
  - Dashboard mit Live-Saldo/Bewegungen, ausstehende SEPA/FinTS
  - CSV/JSON-Export, vollst√§ndige Transparenz-Links
  - Goldfaden-Routing zu/von Gewebekonto-Strukturknoten
- **Oben rechts**: "Konto-Zugriff mit Peer-Verifikation"
  - **Eingeloggt**: Eigene Garnrolle in Profilfarbe mit **Webungs-Rotation** + **Peer-Verifikations-Haken** ‚Üí √∂ffnet Profil-Drawer
  - **Ausgeloggt**: Graues Rollen-Icon mit "+" Badge ‚Üí √∂ffnet Login-Drawer mit **Transparenz-Aufkl√§rung**
  - **Ed25519-Peer-Verifikation** (2-von-N Quorum), Benachrichtigungen, Feature-Flags

### 1.2 Rollen-Darstellung mit radikaler Transparenz

**Alle aktiven Rollen sind vollst√§ndig sichtbar:**
```typescript
interface RolleVisualization {
  id: string;
  displayName: string; // Vollst√§ndiger Name oder "Ausgestiegene-Rolle-A7B2"
  avatar: string; // Profilbild oder "exit" Symbol
  coords: [number, number]; // H3-Zellenmittelpunkt
  isActive: boolean; // false wenn ausgestiegen
  joinedAt: Date;
  lastActivity: Date;
  peerVerified: boolean;
}

// Render-Logik: Radikale Transparenz f√ºr aktive Rollen
function renderRolleMarker(rolle: RolleVisualization) {
  if (!rolle.isActive) {
    // Ausgestiegene Rollen: Grau und anonymisiert, aber sichtbar f√ºr Kontinuit√§t
    return {
      position: rolle.coords,
      icon: 'exit-role',
      label: rolle.displayName, // "Ausgestiegene-Rolle-XYZ"
      opacity: 0.3,
      className: 'exited-role',
      tooltip: 'Diese Rolle hat das Netzwerk verlassen'
    };
  }
  
  // Aktive Rollen: Vollst√§ndige Transparenz
  return {
    position: rolle.coords,
    icon: rolle.avatar,
    label: rolle.displayName,
    opacity: 1.0,
    className: 'active-role',
    tooltip: `${rolle.displayName} - Aktiv seit ${formatDate(rolle.lastActivity)}`
  };
}
```

### 1.3 Webungs-Rotation mit vollst√§ndiger Sichtbarkeit

**Konzept:** Jede Webungsaktion triggert eine sichtbare **7-Sekunden-Drehung** f√ºr alle sichtbar:

```svelte
<script>
  import { onMount } from 'svelte';
  import { socket } from '$lib/socket';
  import { peerConsensus } from '$lib/peer-verification';
  
  export let rolle;
  
  let spinning = false;
  let peerStatus = 'verified'; // 'verified' | 'pending' | 'unverified'
  let spinTimer;
  
  function triggerSpin(ms = 7000, actionType = 'unknown') {
    clearTimeout(spinTimer);
    spinning = true;
    peerStatus = 'pending';
    
    spinTimer = setTimeout(() => {
      spinning = false;
      peerStatus = 'verified';
    }, ms);
  }
  
  export function onLocalAction(actionType) {
    triggerSpin(7000, actionType);
  }
  
  onMount(() => {
    socket.on('role-action', (msg) => {
      if (msg.rolleId === rolle.id) {
        triggerSpin((msg.durationSec ?? 7) * 1000, msg.aktionTyp);
      }
    });
    
    socket.on('peer-consensus', (msg) => {
      if (msg.rolleId === rolle.id) {
        peerStatus = msg.status;
      }
    });
  });
</script>

<div 
  class="rolle-marker {spinning ? 'spin' : ''} peer-{peerStatus}" 
  class:exited={!rolle.isActive}
  aria-label="Rolle {rolle.name} {spinning ? '(k√ºrzlich aktiv)' : ''} - Status: {rolle.isActive ? 'aktiv' : 'ausgestiegen'}"
>
  <div class="garnrolle" style="background: {rolle.isActive ? rolle.farbe : '#999999'}">
    <!-- Peer-Verifikations-Indikator -->
    {#if rolle.isActive}
      <div class="peer-indicator" class:verified={peerStatus === 'verified'}>
        {#if peerStatus === 'verified'}
          <span class="verified-icon">‚úì</span>
        {:else if peerStatus === 'pending'}
          <span class="pending-icon">‚è≥</span>
        {:else}
          <span class="unverified-icon">‚ö†Ô∏è</span>
        {/if}
      </div>
    {:else}
      <!-- Ausstiegs-Symbol -->
      <div class="exit-indicator">
        <span class="exit-icon">üö™</span>
      </div>
    {/if}
  </div>
</div>

<style>
.rolle-marker { 
  width: 36px;
  height: 36px; 
  border-radius: 50%; 
  position: relative; 
}

.garnrolle { 
  width: 100%; 
  height: 100%; 
  border-radius: 50%; 
  background: radial-gradient(#c28a3a,#8a5a1a); 
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  position: relative;
}

/* Ausgestiegene Rollen haben spezielle Darstellung */
.rolle-marker.exited .garnrolle {
  background: radial-gradient(#999, #666);
  opacity: 0.3;
}

.peer-indicator, .exit-indicator {
  position: absolute;
  top: -2px;
  right: -2px;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  border: 2px solid;
}

.peer-indicator.verified {
  border-color: #28a745;
  color: #28a745;
}

.peer-indicator:not(.verified) {
  border-color: #ffc107;
  color: #ffc107;
}

.exit-indicator {
  border-color: #6c757d;
  color: #6c757d;
}

@media (prefers-reduced-motion: no-preference) {
  .spin .garnrolle { 
    animation: rollspin 7s linear; 
  }
  
  @keyframes rollspin {
    from { transform: rotate(0deg) }
    to   { transform: rotate(3600deg) } /* 10 Umdrehungen in 7s */
  }
}

@media (prefers-reduced-motion: reduce) {
  .spin .garnrolle { 
    animation: glow 800ms ease-out; 
  }
  
  @keyframes glow {
    0% { box-shadow: 0 0 0 0 rgba(255,215,0,.7) }
    100% { box-shadow: 0 0 0 12px rgba(255,215,0,0) }
  }
}
</style>
```

### 1.4 Login & Aufkl√§rung mit radikaler Transparenz-Information

**Login-Drawer mit vollst√§ndiger Aufkl√§rung:**
```svelte
<div class="login-drawer transparency-first">
  <h3>üåê Weltgewebe-Zugang ‚Äì Vollst√§ndige Transparenz</h3>
  
  <!-- Kernprinzip-Aufkl√§rung (PROMINENT) -->
  <div class="transparency-notice">
    <h4>üîç WICHTIG: Radikale Sichtbarkeit als Kernprinzip</h4>
    <div class="core-principle">
      <p><strong>Das Weltgewebe basiert auf vollst√§ndiger Transparenz aller Aktionen:</strong></p>
      <ul>
        <li>‚úì Jede deiner Aktionen wird dauerhaft und √∂ffentlich sichtbar gespeichert</li>
        <li>‚úì Deine Position, Beitr√§ge, Spenden und Abstimmungen sind f√ºr alle einsehbar</li>
        <li>‚úì F√§den zwischen dir und anderen Knoten bleiben 7 Tage lang sichtbar</li>
        <li>‚úì Verzwirnte F√§den (Garn) bleiben permanent sichtbar</li>
        <li>‚úì Diese Daten sind Teil des unver√§nderlichen Event-Logs</li>
      </ul>
    </div>
    
    <div class="withdrawal-consequences">
      <h5>üö™ Ausstieg aus dem Netzwerk:</h5>
      <p><strong>Widerruf der Teilnahme hat klare Konsequenzen:</strong></p>
      <ul>
        <li>üîÑ Deine Rolle wird zu "Ausgestiegene-Rolle-XYZ" anonymisiert</li>
        <li>üîí Du kannst keine neuen Aktionen mehr durchf√ºhren</li>
        <li>üìú Deine bisherigen Beitr√§ge bleiben im Event-Log erhalten (anonymisiert)</li>
        <li>üö™ Kompletter Ausstieg aus dem aktiven Netzwerk</li>
        <li>‚ö†Ô∏è Dieser Vorgang ist nicht umkehrbar</li>
      </ul>
    </div>
    
    <div class="consent-declaration">
      <label class="big-checkbox">
        <input type="checkbox" bind:checked={understoodTransparency} />
        <span class="checkmark"></span>
        <strong>Ich verstehe und akzeptiere die radikale Sichtbarkeit als Kernprinzip des Weltgewebes</strong>
      </label>
      
      <label class="big-checkbox">
        <input type="checkbox" bind:checked={understoodWithdrawal} />
        <span class="checkmark"></span>
        <strong>Ich verstehe die Konsequenzen des Ausstiegs (Anonymisierung + Netzwerk-Verlassen)</strong>
      </label>
    </div>
  </div>
  
  <!-- Login-Optionen (nur verf√ºgbar nach Verst√§ndnis-Best√§tigung) -->
  <div class="login-options" class:enabled={understoodTransparency && understoodWithdrawal}>
    <button class="passkey-btn" disabled={!canProceed} on:click={loginWithPasskey}>
      üîê Mit Passkey teilnehmen (Ed25519)
    </button>
    
    <div class="magic-link">
      <input type="email" placeholder="E-Mail f√ºr sicheren Link" bind:value={email} disabled={!canProceed} />
      <button disabled={!canProceed} on:click={sendCryptoMagicLink}>Signierten Link senden</button>
    </div>
  </div>
  
  <div class="peer-status">
    <h4>Peer-Network Status</h4>
    <div class="peer-indicators">
      {#each activePeers as peer}
        <span class="peer-indicator {peer.status}">{peer.name}</span>
      {/each}
    </div>
  </div>
  
  <!-- Anonymer Zugang f√ºr Beobachtung -->
  <div class="anonymous-access">
    <hr>
    <h5>üëÅÔ∏è Nur beobachten (ohne Teilnahme)</h5>
    <p>Du kannst die Weberei anonym betrachten, ohne selbst teilzunehmen oder sichtbar zu werden.</p>
    <button class="observer-btn" on:click={continueAsObserver}>
      Als stiller Beobachter weitermachen
    </button>
  </div>
  
  <!-- Rechtlicher Hinweis (minimal) -->
  <div class="legal-minimal">
    <details>
      <summary>Rechtliche Grundlagen</summary>
      <p><strong>Datenverarbeitung:</strong> Art. 6 Abs. 1 lit. a DSGVO (Einwilligung in vollst√§ndige Transparenz)</p>
      <p><strong>Aufbewahrung:</strong> Unver√§nderlicher Event-Log zur Systemintegrit√§t</p>
      <p><strong>Deine Rechte:</strong> Ausstieg durch Anonymisierung jederzeit m√∂glich</p>
      <p><strong>Verantwortlicher:</strong> Siehe Impressum</p>
    </details>
  </div>
</div>

<style>
.transparency-notice {
  background: #fff3cd;
  border: 2px solid #ffc107;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
}

.core-principle {
  background: #f8f9fa;
  padding: 15px;
  border-radius: 6px;
  margin: 10px 0;
}

.withdrawal-consequences {
  background: #f8d7da;
  border: 1px solid #f5c6cb;
  padding: 15px;
  border-radius: 6px;
  margin: 10px 0;
}

.consent-declaration {
  margin: 20px 0;
  padding: 15px;
  background: #e7f3ff;
  border-radius: 6px;
}

.big-checkbox {
  display: flex;
  align-items: flex-start;
  margin: 15px 0;
  font-size: 16px;
  cursor: pointer;
}

.big-checkbox input[type="checkbox"] {
  width: 20px;
  height: 20px;
  margin-right: 10px;
  flex-shrink: 0;
}

.login-options:not(.enabled) {
  opacity: 0.5;
  pointer-events: none;
}

.anonymous-access {
  margin-top: 20px;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 6px;
}

.observer-btn {
  background: #6c757d;
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 6px;
  cursor: pointer;
}

.observer-btn:hover {
  background: #545b62;
}
</style>
```

### 1.5 Ausstiegs-Interface mit klaren Konsequenzen

**Ausstiegs-Dialog (aus Profil-Drawer):**
```svelte
<div class="exit-interface">
  <h3>üö™ Ausstieg aus dem Weltgewebe</h3>
  
  <div class="exit-explanation">
    <h4>Was passiert beim Ausstieg?</h4>
    <div class="consequences-grid">
      <div class="consequence immediate">
        <h5>üîÑ Sofort:</h5>
        <ul>
          <li>Rolle wird anonymisiert zu "Ausgestiegene-Rolle-{ID}"</li>
          <li>Profilbild verschwindet, graues Symbol</li>
          <li>Keine neuen Aktionen mehr m√∂glich</li>
          <li>Verlust des Zugangs zu allen aktiven Features</li>
        </ul>
      </div>
      
      <div class="consequence preserved">
        <h5>üìú Erhalten bleibt:</h5>
        <ul>
          <li>Bisherige Beitr√§ge (anonymisiert)</li>
          <li>Event-Log-Integrit√§t</li>
          <li>Strukturelle Verbindungen (anonymisiert)</li>
          <li>Governance-Teilnahme (pseudonym)</li>
        </ul>
      </div>
      
      <div class="consequence permanent">
        <h5>‚ö†Ô∏è Dauerhaft:</h5>
        <ul>
          <li>Ausstieg ist nicht umkehrbar</li>
          <li>Keine R√ºckkehr mit derselben Identit√§t</li>
          <li>Event-Log bleibt unver√§nderlich</li>
          <li>Neue Teilnahme nur als neue Rolle m√∂glich</li>
        </ul>
      </div>
    </div>
  </div>
  
  <div class="exit-alternatives">
    <h4>ü§î Alternativen zum vollst√§ndigen Ausstieg:</h4>
    <div class="alternatives">
      <button class="alt-btn" on:click={pauseAccount}>
        ‚è∏Ô∏è Account tempor√§r pausieren (7 Tage)
      </button>
      <button class="alt-btn" on:click={reduceVisibility}>
        üëÅÔ∏è Sichtbarkeit reduzieren (weniger aktiv sein)
      </button>
      <button class="alt-btn" on:click={contactSupport}>
        üí¨ Erst mit Community sprechen
      </button>
    </div>
  </div>
  
  <div class="exit-confirmation">
    <h4>üîê Best√§tigung erforderlich</h4>
    <p>Um versehentliche Ausstiege zu verhindern, best√§tige deine Entscheidung:</p>
    
    <label class="confirmation-text">
      Tippe zur Best√§tigung: <strong>"Ich steige bewusst aus"</strong>
      <input 
        type="text" 
        bind:value={confirmationText}
        placeholder="Ich steige bewusst aus"
        class="confirmation-input"
      />
    </label>
    
    <div class="final-buttons">
      <button 
        class="cancel-btn" 
        on:click={cancelExit}
      >
        ‚ùå Abbrechen - Ich bleibe
      </button>
      
      <button 
        class="exit-btn" 
        disabled={confirmationText !== "Ich steige bewusst aus"}
        on:click={confirmExit}
      >
        üö™ Endg√ºltig aussteigen
      </button>
    </div>
  </div>
</div>

<style>
.exit-interface {
  max-width: 600px;
  padding: 20px;
}

.consequences-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin: 20px 0;
}

.consequence {
  padding: 15px;
  border-radius: 8px;
  border: 2px solid;
}

.consequence.immediate {
  background: #fff3cd;
  border-color: #ffc107;
}

.consequence.preserved {
  background: #d4edda;
  border-color: #28a745;
}

.consequence.permanent {
  background: #f8d7da;
  border-color: #dc3545;
}

.alternatives {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin: 15px 0;
}

.alt-btn {
  padding: 8px 16px;
  background: #f8f9fa;
  border: 1px solid #dee2e6;
  border-radius: 6px;
  cursor: pointer;
}

.alt-btn:hover {
  background: #e9ecef;
}

.exit-confirmation {
  background: #f8d7da;
  padding: 20px;
  border-radius: 8px;
  border: 2px solid #dc3545;
  margin-top: 20px;
}

.confirmation-input {
  width: 100%;
  padding: 8px;
  margin: 10px 0;
  border: 2px solid #dee2e6;
  border-radius: 4px;
}

.final-buttons {
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
  gap: 15px;
}

.cancel-btn {
  background: #28a745;
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 6px;
  cursor: pointer;
  flex: 1;
}

.exit-btn {
  background: #dc3545;
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 6px;
  cursor: pointer;
  flex: 1;
}

.exit-btn:disabled {
  background: #6c757d;
  cursor: not-allowed;
}
</style>
```

***

## 2) Dom√§ne & Regeln

### 2.1 Automatik-Grundsatz mit radikaler Sichtbarkeit

**Aktion ‚áí Faden + Webungs-Rotation + Peer-Verifikation (immer sichtbar):**
- **Jede aktive Nutzeraktion** an einem Karten-Knoten erzeugt automatisch:
  1. Einen Faden von der Rolle zum Handlungsort (Subtyp je Aktion)
  2. **Eine 7s-Webungs-Rotation der Rolle** (global sichtbar f√ºr alle)
  3. **Ed25519-signiertes Event f√ºr Peer-Verifikation**
  4. **Vollst√§ndig transparenten Event-Eintrag** im unver√§nderlichen Log
- **Strukturknoten-Aktionen** erzeugen spezielle F√§den mit erh√∂hter Sichtbarkeit
- **Passive Aktionen** (ansehen/filtern) bleiben neutral und erzeugen keine Logs
- **Login** ist eine System-Aktion ‚Üí erzeugt weder Faden noch Rotation

### 2.2 Verzwirn-Schutz mit Peer-Konsens (volle Transparenz)

**Verzwirnung als einzige Quelle der Wahrheit:**
- **Grundregel**: Jeder darf jeden Knoten bearbeiten
- **Schutz**: Verzwirnte Bereiche sind editiersicher
- **Granularit√§t**: Verzwirnung gilt f√ºr spezifische JSON-Pointer-Pfade (z.B. `/title`, `/sections/2`)
- **Vollschutz**: Verzwirnung mit Scope `"full"` sperrt den gesamten Knoten
- **Strukturknoten-Schutz**: Kritische Strukturknoten-Eigenschaften sind per Default verzwirnt
- **Peer-Validierung**: Verzwirnungen erfordern 2-von-N Peer-Best√§tigung f√ºr Validit√§t
- **Vollst√§ndige Sichtbarkeit**: Alle Verzwirnungen sind √∂ffentlich einsehbar

### 2.3 Knoten-Lebenszyklus mit klaren Regeln

**Strukturknoten sind permanent:**
- **Gewebekonto, Webrat, N√§hst√ºbchen** verfallen niemals
- **Standard-Knoten** folgen Garn-Schutz-Regeln: Solange mindestens ein Garn zu einem Knoten f√ºhrt, bleibt er aktiv
- **Verfall startet erst**, wenn letzter Faden/Garn entkn√ºpft/verblasst ist ‚Üí **KnotenStartetVerfall**, expires_at = now()+7d
- **Fade**: UI-Opacity steigt linear 0 ‚Üí 100% in 7 Tagen; dann **KnotenVerfallen** (Historie bleibt in Events/Timeline)
- **Strukturknoten-Verbindungen** beeinflussen Verfallsregeln

### 2.4 Direkte Demokratie mit sofortiger Partizipation & vollst√§ndiger Transparenz

**Governance-Prinzip:**
- **Antr√§ge**: AntragGestellt erzeugt **Antragsfaden** Rolle ‚Üí **Webrat-Strukturknoten** (immer sichtbar); Timer 7 Tage sichtbar
- **bei Einspruch**: Einspruch aktiviert **Abstimmung 7 Tage nach Einsprucherhebung**
  - Abstimmung ab sofort m√∂glich, Ergebnis nach 7 Tagen
- **kein Einspruch nach 7 Tagen**: sofortige Annahme und Umsetzung des Antrags
- **Transparente Abstimmungen**: StimmeAbgegeben wird √∂ffentlich gespeichert - **jeder sieht, wer wie abstimmt**
- **Abstimmungen sind immer g√ºltig**: Unabh√§ngig von der Beteiligung
- **Einfache Mehrheit**: Beschluss gilt bei mehr Ja- als Nein-Stimmen (Enthaltungen neutral)
- **Sofortige Ausf√ºhrung**: Nach Annahme l√∂st Server sofort `ActionExecuted` aus (idempotent, idempotencyKey = antragId)
- **Delegation**: Stimmen√ºbertragung: Phase A 1:1; Ablauf nach **4 Wochen Inaktivit√§t** des Delegierenden (Timer). Phase B (Flag): transitiv, Cycle-Check
- **Delegationsf√§den**: Immer sichtbar als graue Pfeile von der Rolle des Delegierenden zu der Rolle des Stimmenempf√§ngers. Delegation weiter √ºbertragbar.

```typescript
// Vollst√§ndig transparente Governance Flow
async function processDirectVoteWithFullTransparency(abstimmungId: string) {
  const votes = await getVotesForAbstimmung(abstimmungId);
  
  // Vollst√§ndige Transparenz - alle Stimmen sind √∂ffentlich
  const ja = votes.filter(v => v.choice === 'ja').length;
  const nein = votes.filter(v => v.choice === 'nein').length;
  
  let result: 'angenommen' | 'abgelehnt';
  if (ja > nein) {
    result = 'angenommen';
    
    // SOFORTIGE Ausf√ºhrung ohne weitere Verz√∂gerung
    const antrag = await getAntragByAbstimmung(abstimmungId);
    await executeActionImmediately(antrag.action, antrag.id);
  } else {
    result = 'abgelehnt';
  }
  
  // Vollst√§ndig transparentes Result-Event
  await eventBus.publish({
    type: 'AbstimmungBeendet',
    payload: { 
      abstimmungId, 
      result, 
      stimmenJa: ja, 
      stimmenNein: nein,
      stimmenGesamt: ja + nein,
      immediateDemocracy: true,
      vollst√§ndigeTransparenz: true,
      individualVotes: votes // Alle individuellen Stimmen √∂ffentlich!
    },
    meta: {
      actor: 'system',
      transparencyLevel: 'full'
    }
  });
}
```

### 2.5 Ausstiegs-Mechanismus mit klaren Konsequenzen

**Rolle-Ausstieg durch Anonymisierung + Netzwerk-Verlassen:**



## 3) Event-Schema & Technische Architektur

### 3.1 Event-Schema mit vollst√§ndiger Transparenz

```json
{
  "id": "01HZXY9ABCDEFGHIJK",           // ULID
  "type": "FadenGesponnen",
  "subtype": "gespr√§ch",               // gespraech|gestaltung|veraenderung|antrag|abstimmung|gold|delegation
  "aggregateId": "knoten-550e8400-e29b-41d4-a716-446655440000",
  "aggregateType": "knoten",           // knoten|faden|rolle|antrag|delegation|zahlung|account|session
  "ts": "2025-08-21T12:00:00.000Z",
  "subject": "wg.kleinroennau.social", // Alles √∂ffentlich (au√üer interne System-Events)
  "signature": "ed25519:abc123def456789abcdef...", // Ed25519-Signatur f√ºr Byzantine-Toleranz
  "prev_hash": "sha256:abc123def456...",       // SHA256 des letzten Events f√ºr dieses Aggregat
  "payload": {
    "fromRolle": "rolle-uuid...",
    "toKnoten": "knoten-uuid...",
    "toStructuralType": "webrat",      // gewebekonto|webrat|naehstuebchen|null
    "content": "Das ist interessant!",
    "expiresAt": "2025-08-26T15:22:00.000Z",
    "h3": 599405658847379,
    "isStructuralConnection": true,    // Flag f√ºr Strukturknoten-Verbindungen
    "transparencyLevel": "full"        // Vollst√§ndige Sichtbarkeit
  },
  "meta": {
    "actor": "rolle-uuid...",
    "msgId": "deterministic-dedup-key", // F√ºr Idempotenz
    "ipHash": "sha256(ip+salt+date)",   // Minimale Pseudonymisierung
    "peerQuorum": ["peer1-id", "peer2-id"], // Peer-Verifikation
    "consensusAchieved": true,          // Byzantine-Konsens Status
    "peerSignatures": {                 // Ed25519-Peer-Best√§tigungen
      "peer1-id": "ed25519:signature1...",
      "peer2-id": "ed25519:signature2..."
    },
    "fullyTransparent": true            // Kennzeichnung f√ºr vollst√§ndige Transparenz
  }
}
```

### 3.2 Ausstiegs-Events (√∂ffentlich sichtbar)

```json
{
  "type": "RoleExitInitiated",
  "aggregateId": "rolle-uuid",
  "subject": "wg.kleinroennau.social",
  "ts": "2025-08-21T12:00:00Z",
  "signature": "ed25519:final-signature...",
  "payload": {
    "rolleId": "rolle-uuid",
    "exitReason": "voluntary_withdrawal",
    "understoodConsequences": true,
    "confirmationProvided": "Ich steige bewusst aus",
    "anonymizationRequested": true
  },
  "meta": {
    "actor": "rolle-uuid",
    "finalAction": true,
    "publiclyVisible": true
  }
}
```

```json
{
  "type": "RoleExited",
  "aggregateId": "rolle-uuid",
  "subject": "wg.kleinroennau.social",
  "payload": {
    "rolleId": "rolle-uuid",
    "exitId": "exit-ulid",
    "newDisplayName": "Ausgestiegene-Rolle-A7B2",
    "avatar": "exit",
    "anonymizedAt": "2025-08-21T12:05:00Z",
    "retainedInNetwork": false,
    "dataRetained": ["anonymized_contributions", "event_log_integrity"],
    "dataRemoved": ["personal_identity", "active_capabilities"],
    "reversibility": false
  },
  "meta": {
    "executor": "system",
    "publicAuditTrail": true,
    "networkIntegrityMaintained": true
  }
}
```

### 3.3 Transparente Abstimmungs-Events

```json
{
  "type": "StimmeAbgegeben",
  "aggregateId": "abstimmung-uuid",
  "subject": "wg.kleinroennau.social",
  "payload": {
    "abstimmungId": "abstimmung-uuid",
    "rolleId": "rolle-uuid",           // Vollst√§ndig transparent!
    "rolleName": "Max Mustermann",     // Name sichtbar!
    "choice": "ja",                    // Stimme √∂ffentlich!
    "timestamp": "2025-08-21T12:00:00Z",
    "reasoning": "Ich unterst√ºtze diesen Vorschlag, weil...", // Optional
    "delegatedFrom": ["rolle2-uuid"],  // Falls delegiert
    "voteWeight": 2                    // Bei Delegation
  },
  "meta": {
    "actor": "rolle-uuid",
    "transparency": "full_public",
    "governanceParticipation": true
  }
}
```

### 3.4 Vollst√§ndige Transparenz bei Strukturknoten-Interaktionen

```json
{
  "type": "StrukturknotenInteraktion",
  "aggregateId": "strukturknoten-uuid",
  "subject": "wg.kleinroennau.social",
  "payload": {
    "strukturknotenTyp": "gewebekonto",
    "interaktionsTyp": "goldfaden_routing",
    "rolleId": "rolle-uuid",
    "rolleName": "Max Mustermann",     // Namen sichtbar
    "targetKnoten": "ziel-knoten-uuid",
    "metadata": {
      "betrag": 1500,                  // Betr√§ge sichtbar
      "verwendungszweck": "Spende f√ºr Gemeinschaftsgarten",
      "timestamp": "2025-08-21T12:00:00Z"
    },
    "publiclyVisible": true            // Explizit √∂ffentlich
  },
  "meta": {
    "transparency": "full",
    "financialTransparency": true
  }
}
```

### 3.5 Aktion‚ÜíEvent‚ÜíFaden‚ÜíRotation Mapping (vollst√§ndige Transparenz)

| Benutzeraktion | Event(s) | Faden | Webungs-Rotation | Sichtbarkeit | Strukturknoten |
|---|---|---|---|---|---|
| Kommentar in Raum | `FadenGesponnen{gespr√§ch}` + `RolleWebtAktion` | Ja | **7s** | **√ñffentlich** | ‚Üí N√§hst√ºbchen |
| **Spende** | `GoldfadenInitiated` + `FadenGesponnenStrukturell{gold}` | Ja | **7s** | **Betrag + Name √∂ffentlich** | **‚Üí Gewebekonto** |
| **Abstimmung** | `StimmeAbgegeben` + `FadenGespannenStrukturell{abstimmung}` | Ja | **7s** | **Stimme + Name √∂ffentlich** | **‚Üí Webrat** |
| **Ausstieg** | `RoleExitInitiated` ‚Üí `RoleExited` | Nein | Nein | **√ñffentlich** | **Network Exit** |
| Knoten kn√ºpfen | `KnotenGeknuepft` + `FadenGesponnen{gestaltung}` | Ja | **7s** | **√ñffentlich** | - |
| Verzwirnen | `FadenVerzwirnt` | - | **7s** | **√ñffentlich** | Enhanced Security |

***

## 4) System-Architektur & Implementation

### 4.1 Vereinfachte System-Architektur ohne komplexe Privacy-Layer

```
[SvelteKit PWA + MapLibre + ServiceWorker + Dexie + Ed25519-Crypto]
   ‚îÇ  HTTPS/WSS (TLS 1.3, CSP strict)
   ‚ñº
[NGINX + Varnish] ‚îÄ‚îÄ‚Üí [Fastify API + Transparency-First]
   ‚îÇ                    ‚îÇ  Zod-Validation, Commands‚ÜíEvents
   ‚îÇ                    ‚îÇ  Auth: WebAuthn + Magic-Link + Session
   ‚îÇ                    ‚îÇ  üÜï Exit-Manager f√ºr Rolle-Ausstiege
   ‚îÇ                    ‚îÇ  üÜï Transparency-Engine f√ºr vollst√§ndige Sichtbarkeit
   ‚îÇ                    ‚ñº
   ‚îÇ              [EventBus (vereinfacht)]
   ‚îÇ                ‚îú‚îÄ‚Üí [NATS JetStream] (Primary SoR)
   ‚îÇ                ‚îî‚îÄ‚Üí [Redis Streams] (Cache + Sessions)
   ‚îÇ                      ‚îÇ
   ‚îÇ                      ‚îú‚îÄ‚Üí [Projection Worker (transparenz-optimiert)]
   ‚îÇ                      ‚îÇ     ‚îî‚îÄ‚Üí [PostgreSQL + PostGIS (vereinfachtes Schema)]
   ‚îÇ                      ‚îÇ
   ‚îÇ                      ‚îî‚îÄ‚Üí [Background Jobs]
   ‚îÇ                            ‚îú‚îÄ‚Üí [BullMQ Timer] (7d/4w expiry + session sweep)
   ‚îÇ                            ‚îú‚îÄ‚Üí [FinTS Poller] (4h + backoff + Gewebekonto)
   ‚îÇ                            ‚îî‚îÄ‚Üí [Exit-Processor] (Rolle-Ausstiege verarbeiten)
   ‚îÇ
   ‚îî‚îÄ‚Üí [Monitoring Stack (vereinfacht)]
         ‚îú‚îÄ‚Üí [Netdata] (Basis-Monitoring)
         ‚îú‚îÄ‚Üí [Healthchecks.io] (Uptime)
         ‚îî‚îÄ‚Üí [Simple Alerting] (Matrix/Signal Webhook)
```

### 4.2 Exit-Manager f√ºr Rolle-Ausstiege

```typescript
class ExitManager {
  constructor(
    private eventBus: EventBus,
    private projectionManager: ProjectionManager,
    private authManager: AuthManager
  ) {}
  
  async initiateRoleExit(rolleId: string, confirmationText: string, reason: string): Promise<ExitResult> {
    // Validierung der Best√§tigung
    if (confirmationText !== "Ich steige bewusst aus") {
      throw new Error('Best√§tigung fehlerhaft');
    }
    
    const rolle = await this.getRolle(rolleId);
    if (!rolle || !rolle.isActive) {
      throw new Error('Rolle bereits inaktiv oder nicht gefunden');
    }
    
    const exitId = generateULID();
    
    // 1. Exit-Initiation Event (√∂ffentlich)
    await this.eventBus.publish({
      type: 'RoleExitInitiated',
      aggregateId: rolleId,
      subject: 'wg.kleinroennau.social', // √ñffentlich!
      payload: {
        rolleId,
        exitReason: reason,
        understoodConsequences: true,
        confirmationProvided: confirmationText,
        exitId
      },
      meta: {
        actor: rolleId,
        finalAction: true,
        publiclyVisible: true
      }
    });
    
    // 2. Sofortiger Auth-Session Kill
    await this.authManager.terminateAllSessions(rolleId);
    
    // 3. Rolle deaktivieren
    await this.deactivateRole(rolleId, exitId);
    
    // 4. Anonymisierung starten
    const anonymizationResult = await this.anonymizeRole(rolleId, exitId);
    
    // 5. Completion Event (√∂ffentlich)
    await this.eventBus.publish({
      type: 'RoleExited',
      aggregateId: rolleId,
      subject: 'wg.kleinroennau.social', // √ñffentlich!
      payload: {
        rolleId,
        exitId,
        newDisplayName: anonymizationResult.pseudoName,
        avatar: 'exit',
        anonymizedAt: new Date(),
        retainedInNetwork: false,
        dataRetained: ['anonymized_contributions', 'event_log_integrity'],
        dataRemoved: ['personal_identity', 'active_capabilities'],
        reversibility: false
      },
      meta: {
        executor: 'system',
        publicAuditTrail: true,
        networkIntegrityMaintained: true
      }
    });
    
    return {
      exitId,
      pseudoName: anonymizationResult.pseudoName,
      exitedAt: new Date(),
      reversible: false,
      networkAccess: false,
      message: 'Du hast das Weltgewebe dauerhaft verlassen. Deine Beitr√§ge bleiben anonymisiert im System, aber du kannst keine neuen Aktionen durchf√ºhren.'
    };
  }
  
  private async anonymizeRole(rolleId: string, exitId: string): Promise<AnonymizationResult> {
    const pseudoName = `Ausgestiegene-Rolle-${exitId.slice(0, 4).toUpperCase()}`;
    
    // Update Rolle-Projektion
    await this.projectionManager.anonymizeRole({
      rolleId,
      newDisplayName: pseudoName,
      avatar: 'exit',
      isActive: false,
      exited: true,
      exitedAt: new Date()
    });
    
    // Update alle F√§den/Beitr√§ge
    await this.projectionManager.anonymizeRolleContributions(rolleId, pseudoName);
    
    return { pseudoName, anonymizedAt: new Date() };
  }
  
  async checkCanPerformAction(rolleId: string): Promise<boolean> {
    const rolle = await this.getRolle(rolleId);
    return rolle?.isActive ?? false;
  }
}
```

### 4.3 Vereinfachtes Database-Schema (ohne komplexe Privacy-Tables)

```sql
-- Vereinfachte Rollen-Tabelle
CREATE TABLE rollen (
  id UUID PRIMARY KEY,
  name TEXT NOT NULL,
  email TEXT UNIQUE,
  avatar TEXT,
  coords GEOGRAPHY(POINT) NOT NULL,
  h3 BIGINT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now(),
  is_active BOOLEAN DEFAULT TRUE,
  exited_at TIMESTAMPTZ,
  can_perform_actions BOOLEAN DEFAULT TRUE,
  anonymized BOOLEAN DEFAULT FALSE,
  last_activity TIMESTAMPTZ DEFAULT now()
);

-- Vereinfachte Knoten-Tabelle
CREATE TABLE knoten (
  id UUID PRIMARY KEY,
  typ knoten_typ NOT NULL,
  title TEXT NOT NULL,
  content JSONB,
  coords GEOGRAPHY(POINT) NOT NULL,
  h3 BIGINT NOT NULL,
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  is_structural BOOLEAN DEFAULT FALSE,
  fade_started_at TIMESTAMPTZ,
  expires_at TIMESTAMPTZ,
  last_linked_at TIMESTAMPTZ,
  has_garn BOOLEAN DEFAULT FALSE,
  peer_signatures JSONB DEFAULT '[]'
);

-- Vereinfachte F√§den-Tabelle (alle √∂ffentlich)
CREATE TABLE faeden (
  id UUID PRIMARY KEY,
  from_rolle UUID REFERENCES rollen(id) NOT NULL,
  to_knoten UUID REFERENCES knoten(id) NOT NULL,
  subtype faden_subtype NOT NULL,
  content TEXT,
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  expires_at TIMESTAMPTZ NOT NULL,
  is_garn BOOLEAN DEFAULT FALSE,
  is_structural_connection BOOLEAN DEFAULT FALSE,
  structural_type strukturknoten_typ,
  routing_metadata JSONB,
  peer_verified BOOLEAN DEFAULT FALSE,
  peer_signatures JSONB DEFAULT '[]'
);

-- Transparente Abstimmungen (alle √∂ffentlich)
CREATE TABLE abstimmungen (
  id UUID PRIMARY KEY,
  antrag_id UUID REFERENCES antraege(id) NOT NULL,
  rolle_id UUID REFERENCES rollen(id) NOT NULL,
  rolle_name TEXT NOT NULL, -- Name explizit gespeichert f√ºr Transparenz
  choice vote_choice NOT NULL,
  reasoning TEXT, -- Optional: Begr√ºndung
  delegated_from UUID[], -- Array von delegierenden Rollen
  vote_weight INTEGER DEFAULT 1,
  created_at TIMESTAMPTZ DEFAULT now()
);

-- Exit-Audit-Log (√∂ffentlich einsehbar)
CREATE TABLE role_exits (
  id UUID PRIMARY KEY,
  rolle_id UUID NOT NULL,
  exit_id TEXT NOT NULL,
  exit_reason TEXT,
  pseudo_name TEXT NOT NULL,
  exited_at TIMESTAMPTZ DEFAULT now(),
  confirmation_provided TEXT,
  anonymization_completed BOOLEAN DEFAULT FALSE,
  public_audit_trail JSONB DEFAULT '{}'
);

-- Vereinfachte Verzwirnungen (alle √∂ffentlich)
CREATE TABLE verzwirnungen (
  id UUID PRIMARY KEY,
  knoten_id UUID NOT NULL REFERENCES knoten(id) ON DELETE CASCADE,
  rolle_id UUID NOT NULL REFERENCES rollen(id),
  scope JSONB NOT NULL, -- "full" oder ["/title", "/sections/2"]
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  peer_signatures JSONB DEFAULT '[]',
  consensus_achieved BOOLEAN DEFAULT FALSE,
  is_structural BOOLEAN DEFAULT FALSE
);

-- Performance-Indizes
CREATE INDEX IF NOT EXISTS idx_rollen_active ON rollen(is_active, exited_at);
CREATE INDEX IF NOT EXISTS idx_faeden_structural ON faeden(is_structural_connection, structural_type);
CREATE INDEX IF NOT EXISTS idx_abstimmungen_public ON abstimmungen(antrag_id, created_at);
CREATE INDEX IF NOT EXISTS idx_role_exits_public ON role_exits(exited_at, public_audit_trail);
```

### 4.4 Transparency-First API-Endpoints

```typescript
// Middleware: Action-Guard f√ºr ausgestiegene Rollen
async function actionGuard(req: FastifyRequest, reply: FastifyReply) {
  const rolleId = req.user?.rolleId;
  if (!rolleId) return; // Anonymous OK
  
  const canAct = await exitManager.checkCanPerformAction(rolleId);
  if (!canAct) {
    return reply.code(403).send({
      error: 'role_exited',
      message: 'Diese Rolle hat das Netzwerk verlassen und kann keine Aktionen durchf√ºhren.',
      exitInfo: await getRoleExitInfo(rolleId)
    });
  }
}

// POST /api/me/exit - Rolle-Ausstieg
app.post('/api/me/exit', async (req, reply) => {
  const { confirmationText, reason = 'voluntary_withdrawal' } = req.body;
  const rolleId = req.user.rolleId;
  
  try {
    const exitResult = await exitManager.initiateRoleExit(
      rolleId, 
      confirmationText, 
      reason
    );
    
    // Session sofort beenden
    req.session.destroy();
    
    reply.send({
      success: true,
      exitId: exitResult.exitId,
      pseudoName: exitResult.pseudoName,
      message: exitResult.message,
      redirectTo: '/exit-completed'
    });
  } catch (error) {
    reply.code(400).send({
      error: 'exit_failed',
      message: error.message
    });
  }
});

// GET /api/governance/votes/:abstimmungId - Vollst√§ndig transparente Abstimmungsergebnisse
app.get('/api/governance/votes/:abstimmungId', async (req, reply) => {
  const { abstimmungId } = req.params;
  
  const votes = await db.abstimmungen.findMany({
    where: { antrag_id: abstimmungId },
    include: {
      rolle: {
        select: { 
          id: true, 
          name: true, 
          avatar: true,
          is_active: true 
        }
      }
    },
    orderBy: { created_at: 'asc' }
  });
  
  const summary = {
    total: votes.length,
    ja: votes.filter(v => v.choice === 'ja').length,
    nein: votes.filter(v => v.choice === 'nein').length,
    enthaltung: votes.filter(v => v.choice === 'enthaltung').length
  };
  
  // Vollst√§ndige Transparenz: Alle individuellen Stimmen mit Namen
  reply.send({
    summary,
    individualVotes: votes.map(vote => ({
      rolleId: vote.rolle_id,
      rolleName: vote.rolle_name,
      avatar: vote.rolle.avatar,
      choice: vote.choice,
      reasoning: vote.reasoning,
      timestamp: vote.created_at,
      voteWeight: vote.vote_weight,
      delegatedFrom: vote.delegated_from,
      isActiveRole: vote.rolle.is_active
    })),
    transparencyLevel: 'full_public',
    message: 'Alle Stimmen sind √∂ffentlich einsehbar - das ist ein Kernprinzip des Weltgewebes.'
  });
});

// GET /api/exits/recent - √ñffentliche Einsicht in Rolle-Ausstiege
app.get('/api/exits/recent', async (req, reply) => {
  const recentExits = await db.role_exits.findMany({
    orderBy: { exited_at: 'desc' },
    take: 50,
    select: {
      exit_id: true,
      pseudo_name: true,
      exit_reason: true,
      exited_at: true,
      confirmation_provided: true
    }
  });
  
  reply.send({
    exits: recentExits,
    total: recentExits.length,
    transparencyNote: 'Alle Ausstiege sind √∂ffentlich dokumentiert f√ºr Netzwerk-Transparenz.',
    anonymizedData: true
  });
});

// GET /api/knoten/:id (ohne Privacy-Filter)
app.get('/api/knoten/:id', async (req, reply) => {
  const { id } = req.params;
  
  const knoten = await db.knoten.findUnique({
    where: { id },
    include: {
      faeden: {
        include: {
          rolle: {
            select: { 
              id: true, 
              name: true, 
              avatar: true,
              is_active: true 
            }
          }
        }
      },
      verzwirnungen: {
        include: {
          rolle: {
            select: { 
              id: true, 
              name: true 
            }
          }
        }
      }
    }
  });
  
  if (!knoten) {
    return reply.code(404).send({ error: 'knoten_not_found' });
  }
  
  // Keine Privacy-Filter - vollst√§ndige Transparenz
  reply.send({
    ...knoten,
    transparencyLevel: 'full',
    allDataPublic: true
  });
});
```

***

## 5) Performance & Monitoring

### 5.1 Vereinfachte Monitoring-Metriken ohne Privacy-Overhead

```typescript
export const simplifiedMetrics = {
  // Basis-System-Metriken
  activeRoles: new Gauge({
    name: 'wg_active_roles_total',
    help: 'Anzahl aktiver Rollen im Netzwerk'
  }),
  
  exitedRoles: new Counter({
    name: 'wg_exited_roles_total',
    help: 'Anzahl ausgestiegener Rollen',
    labelNames: ['reason']
  }),
  
  // Transparenz-Metriken
  transparentActions: new Counter({
    name: 'wg_transparent_actions_total',
    help: 'Vollst√§ndig transparente Aktionen',
    labelNames: ['action_type', 'strukturknoten_typ']
  }),
  
  // Governance-Metriken
  publicVotes: new Counter({
    name: 'wg_public_votes_total',
    help: '√ñffentliche Abstimmungen',
    labelNames: ['choice', 'has_reasoning']
  }),
  
  // Strukturknoten-Metriken
  strukturknotenInteraktionen: new Counter({
    name: 'wg_strukturknoten_interactions_total',
    help: 'Interaktionen mit Strukturknoten',
    labelNames: ['strukturknoten_typ', 'interaktions_typ']
  }),
  
  webratAktivitaet: new Gauge({
    name: 'wg_webrat_active_votes',
    help: 'Aktive Abstimmungen im Webrat'
  }),
  
  gewebekontoTransaktionen: new Counter({
    name: 'wg_gewebekonto_transactions_total', 
    help: '√ñffentliche Goldfaden-Transaktionen',
    labelNames: ['betrag_range']
  }),
  
  // Peer-Verifikations-Metriken
  peerConsensusLatency: new Histogram({
    name: 'wg_peer_consensus_duration_ms',
    help: 'Zeit f√ºr Peer-Consensus-Prozess',
    buckets: [50, 100, 250, 500, 1000, 2000]
  }),
  
  peerNetworkHealth: new Gauge({
    name: 'wg_peer_network_health_score',
    help: 'Peer-Network-Gesundheits-Score (0-1)'
  }),
  
  // Kosten-Metriken
  infrastructureCosts: new Gauge({
    name: 'wg_infrastructure_costs_eur_per_month',
    help: 'Monatliche Infrastrukturkosten in EUR',
    labelNames: ['phase', 'component']
  }),
  
  costPerEvent: new Gauge({
    name: 'wg_cost_per_1k_events_eur',
    help: 'Kosten pro 1000 Events in EUR (30-Tage-Durchschnitt)'
  }),
  
  // Performance ohne Privacy-Overhead
  apiResponseTime: new Histogram({
    name: 'wg_api_response_time_ms',
    help: 'API-Response-Zeit ohne Privacy-Filter',
    buckets: [10, 25, 50, 100, 250, 500]
  }),
  
  databaseQueryTime: new Histogram({
    name: 'wg_database_query_duration_ms',
    help: 'Datenbankabfrage-Zeit (vereinfacht)',
    buckets: [5, 10, 25, 50, 100, 250]
  })
};
```

### 5.2 Vereinfachte Alerting Rules

```yaml
# simplified-alerts.yml
groups:
- name: weltgewebe-simplified.rules
  rules:
  
  # Basis-System-Health
  - alert: SystemNichtErreichbar
    expr: up{job="weltgewebe"} == 0
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "Weltgewebe-System nicht erreichbar"
      
  # Rolle-Ausstiege monitoring
  - alert: VielRollenAusstiege
    expr: rate(wg_exited_roles_total[1h]) > 0.1
    for: 30m
    labels:
      severity: warning
    annotations:
      summary: "Ungew√∂hnlich viele Rolle-Ausstiege"
      description: "{{ $value }} Ausstiege pro Stunde"
      
  # Kosten-Monitoring
  - alert: InfrastrukturkostenZuHoch
    expr: wg_infrastructure_costs_eur_per_month > 300
    for: 10m
    labels:
      severity: warning
    annotations:
      summary: "Infrastrukturkosten √ºberschreiten Budget"
      description: "Aktuelle Kosten: ‚Ç¨{{ $value }}/Monat"
      
  - alert: CostPerEventZuHoch
    expr: wg_cost_per_1k_events_eur > 0.015
    for: 30m
    labels:
      severity: warning
    annotations:
      summary: "Kosten pro Event zu hoch"
      description: "‚Ç¨{{ $value }} pro 1000 Events (Ziel: <‚Ç¨0,01)"
      
  # Performance-Monitoring
  - alert: APILatenzHoch
    expr: histogram_quantile(0.95, wg_api_response_time_ms) > 500
    for: 10m
    labels:
      severity: warning
    annotations:
      summary: "API-Response-Zeit zu hoch"
      description: "P95 Response-Zeit: {{ $value }}ms"
      
  # Strukturknoten-Health
  - alert: WebratInaktiv
    expr: wg_webrat_active_votes == 0 AND increase(wg_strukturknoten_interactions_total{strukturknoten_typ="webrat"}[24h]) == 0
    for: 6h
    labels:
      severity: info
    annotations:
      summary: "Webrat zeigt keine Aktivit√§t"
      description: "Keine Abstimmungen oder Interaktionen in 24h"
```

***

## 6) Rechtliche Grundlagen & Minimaler Datenschutz

### 6.1 Transparenz-First Rechtliche Basis

**Verarbeitungsgrundlagen (Art. 6 DSGVO) - vereinfacht:**
- **Art. 6 Abs. 1 lit. a**: Explizite Einwilligung in vollst√§ndige Transparenz aller Aktionen
- **Art. 6 Abs. 1 lit. f**: Berechtigtes Interesse an unver√§nderlichem Event-Log f√ºr Systemintegrit√§t

**Aufkl√§rung vor Teilnahme (Art. 13 DSGVO):**
```typescript
const transparencyDisclosure = {
  title: "Vollst√§ndige Aufkl√§rung √ºber Datenverarbeitung im Weltgewebe",
  
  coreMessage: `
    Das Weltgewebe basiert auf dem Prinzip radikaler Sichtbarkeit. 
    Mit deiner Teilnahme stimmst du zu, dass ALLE deine Aktionen 
    dauerhaft, √∂ffentlich und unver√§nderlich gespeichert werden.
  `,
  
  dataProcessing: {
    collected: [
      "Name und Kontaktdaten",
      "Geografische Position (H3-Zelle)",
      "Alle Beitr√§ge, Kommentare und Aktionen",
      "Abstimmungsverhalten mit Name",
      "Spenden mit Betrag und Name",
      "Verbindungen zu anderen Rollen"
    ],
    
    purpose: [
      "Transparente Gemeinschaftsorganisation",
      "Unver√§nderlicher Audit-Trail",
      "Demokratische Entscheidungsfindung",
      "Peer-Verifikation und Systemintegrit√§t"
    ],
    
    visibility: "Vollst√§ndig √∂ffentlich f√ºr alle Teilnehmenden",
    
    retention: "Dauerhaft im unver√§nderlichen Event-Log",
    
    recipients: [
      "Alle aktiven Rollen im Netzwerk",
      "Peer-Network-Knoten", 
      "√ñffentlich einsehbar"
    ]
  },
  
  yourRights: {
    access: "Jederzeit Einsicht in alle deine Daten",
    rectification: "Berichtigung bei falschen Daten m√∂glich",
    erasure: "Nur durch kompletten Ausstieg mit Anonymisierung",
    portability: "Datenexport jederzeit m√∂glich",
    objection: "Widerspruch = Ausstieg aus dem Netzwerk",
    
    limitation: `
      WICHTIG: Das Recht auf L√∂schung ist eingeschr√§nkt, da vollst√§ndige 
      L√∂schung die Integrit√§t des unver√§nderlichen Event-Logs zerst√∂ren w√ºrde. 
      Stattdessen bieten wir Anonymisierung mit vollst√§ndigem Netzwerk-Ausstieg.
    `
  },
  
  withdrawalConsequences: {
    immediate: [
      "Rolle wird zu 'Ausgestiegene-Rolle-XYZ' anonymisiert",
      "Kein Zugang zu aktiven Features mehr",
      "Alle Sessions werden beendet"
    ],
    
    retained: [
      "Bisherige Beitr√§ge bleiben anonymisiert erhalten",
      "Event-Log-Integrit√§t wird gew√§hrleistet",
      "Strukturelle Verbindungen bleiben anonymisiert bestehen"
    ],
    
    irreversible: "Der Ausstieg ist endg√ºltig und nicht umkehrbar"
  }
};
```

### 6.2 Minimaler Compliance-Rahmen

**Einwilligung-Validierung:**
```typescript
class MinimalComplianceManager {
  
  async validateInformedConsent(consentData: ConsentData): Promise<boolean> {
    return (
      consentData.understoodTransparency &&
      consentData.understoodWithdrawal &&
      consentData.acceptedConsequences &&
      consentData.policyVersion === CURRENT_POLICY_VERSION
    );
  }
  
  async processWithdrawal(rolleId: string): Promise<WithdrawalResult> {
    // Vereinfachter Widerruf = kompletter Ausstieg
    return await exitManager.initiateRoleExit(
      rolleId, 
      "Widerruf der Einwilligung", 
      "gdpr_withdrawal"
    );
  }
  
  async generateDataExport(rolleId: string): Promise<ExportData> {
    // Vollst√§ndiger Export aller Daten
    const rolle = await getRolleWithAllData(rolleId);
    
    return {
      personalData: {
        name: rolle.name,
        email: rolle.email,
        position: rolle.coords,
        joinedAt: rolle.created_at
      },
      
      activities: await getAllRoleActivities(rolleId),
      votes: await getAllRoleVotes(rolleId),
      contributions: await getAllRoleContributions(rolleId),
      connections: await getAllRoleConnections(rolleId),
      
      transparency: {
        allDataPublic: true,
        retentionPeriod: "permanent",
        sharingScope: "all_network_participants"
      },
      
      format: "json",
      exportedAt: new Date(),
      dataIntegrity: await calculateDataHash(rolle)
    };
  }
}
```

### 6.3 Minimale Datenschutzerkl√§rung

**Kurze, klare Datenschutzerkl√§rung:**

```markdown
# Datenschutz im Weltgewebe

## Grundprinzip
Das Weltgewebe basiert auf **radikaler Transparenz**. Alle deine Aktionen sind 
dauerhaft und √∂ffentlich sichtbar. Dies ist kein Bug, sondern das Kernprinzip.

## Was passiert mit deinen Daten?
- **Erfassung**: Name, Position, alle Beitr√§ge, Abstimmungen, Spenden
- **Verwendung**: Transparente Gemeinschaftsorganisation
- **Sichtbarkeit**: Vollst√§ndig √∂ffentlich f√ºr alle Teilnehmenden
- **Speicherdauer**: Dauerhaft im unver√§nderlichen Event-Log

## Deine Rechte
- **Auskunft**: Jederzeit vollst√§ndige Einsicht
- **Berichtigung**: Bei falschen Daten
- **L√∂schung**: Nur durch Ausstieg mit Anonymisierung
- **Widerspruch**: F√ºhrt zu vollst√§ndigem Netzwerk-Ausstieg

## Ausstieg
Widerruf deiner Einwilligung bedeutet:
- Anonymisierung zu "Ausgestiegene-Rolle-XYZ"
- Kompletter Verlust des Zugangs
- Bisherige Beitr√§ge bleiben anonymisiert erhalten
- **Nicht umkehrbar**

## Rechtsgrundlage
Art. 6 Abs. 1 lit. a DSGVO (Einwilligung) - du stimmst bewusst der 
vollst√§ndigen Transparenz zu.

## Kontakt
Bei Fragen: datenschutz@weltgewebe.net
Datenschutzaufsicht: Je nach Bundesland
```

***

## 7) Kosten- & Infrastrukturstrategie (unver√§ndert)

Die gestufte Kostenarchitektur bleibt wie in v14.4 definiert:

- **Phase A**: ‚Ç¨90-250/Monat, Single-Server, 50-200 Nutzer
- **Phase B**: ‚Ç¨250-600/Monat, Community-Server, 200-1000 Nutzer  
- **Phase C**: Community-finanziert, 5000+ Nutzer, <‚Ç¨0.01/1000 Events

Die Vereinfachung der Privacy-Architektur reduziert die Komplexit√§t und damit die Betriebskosten erheblich.

***

## 8) Implementierungsplan & Phasen

### 8.1 Phase A: Transparenz-First Implementation (0-10 Wochen)

**Sprint 1-2: Transparenz-Fundament (Wochen 1-2)**
- ‚úÖ Vereinfachtes Database-Schema ohne Privacy-Komplexit√§t
- ‚úÖ Exit-Manager f√ºr Rolle-Ausstiege implementieren
- ‚úÖ Transparency-First Event-Schema
- ‚úÖ Aufkl√§rungs-UI f√ºr radikale Sichtbarkeit

**Sprint 3-4: Strukturknoten mit vollst√§ndiger Transparenz (Wochen 3-4)**
- ‚úÖ Strukturknoten-Typen (Gewebekonto, Webrat, N√§hst√ºbchen) 
- ‚úÖ Vollst√§ndig transparente Strukturknoten-Interaktionen
- ‚úÖ √ñffentliche Goldfaden-Routing im Gewebekonto
- ‚úÖ Transparente Governance im Webrat

**Sprint 5-6: Peer-Verifikation vereinfacht (Wochen 5-6)**
- ‚úÖ Ed25519-Signatur-Integration (vereinfacht)
- ‚úÖ Simuliertes Peer-Consensus-System (Phase A)
- ‚úÖ WebAuthn-Integration mit Transparenz-Consent

**Sprint 7-8: Direkte Demokratie mit vollst√§ndiger Transparenz (Wochen 7-8)**
- ‚úÖ Sofortige Abstimmungsaktivierung nach Einspruch
- ‚úÖ Vollst√§ndig transparente Abstimmungen (Name + Stimme √∂ffentlich)
- ‚úÖ √ñffentliche Abstimmungsergebnisse mit individuellen Stimmen
- ‚úÖ Transparente Webrat-Integration

**Sprint 9-10: UX Polish & Exit-Flows (Wochen 9-10)**
- ‚úÖ Erweiterte Webungs-Rotation f√ºr ausgestiegene Rollen
- ‚úÖ Ausstiegs-Interface mit klaren Konsequenzen
- ‚úÖ √ñffentliche Exit-Logs und Transparenz-Dashboards
- ‚úÖ Mobile-optimierte Transparenz-Aufkl√§rung

**Phase A - Qualit√§ts-Gates:**
- **Radikale Transparenz**: Alle Aktionen √∂ffentlich sichtbar
- **Klare Ausstiegs-Konsequenzen**: Anonymisierung + Netzwerk-Verlassen
- **Strukturknoten**: Transparente Interaktionen ohne Privacy-Overhead
- **Kosten**: ‚Ç¨90-250/Monat durch Vereinfachung
- **Performance**: Schnelle APIs ohne Privacy-Filter
- **Aufkl√§rung**: Vollst√§ndige Transparenz-Information vor Beitritt

***

## 9) Schlusswort & Vision

### 9.1 Revolution√§re Klarheit v14.5

**üîç Radikale Sichtbarkeit als Kernwert**: Das Weltgewebe v14.5 macht Transparenz zu seinem unverhandelbaren Fundament. Jede Aktion ist √∂ffentlich, jede Stimme sichtbar, jede Spende transparent ‚Äì weil echte Gemeinschaft nur durch vollst√§ndige Offenheit entstehen kann.

**üö™ Klare Ausstiegs-Konsequenzen**: Wer das Netzwerk verl√§sst, wird anonymisiert und verliert den Zugang dauerhaft. Keine Grauzone, keine Teilr√ºcknahme. Diese Klarheit schafft Vertrauen und verhindert Missbrauch.

**üí∞ Vereinfachte Kostenstruktur**: Durch den Verzicht auf komplexe Privacy-Layer wird das System erheblich effizienter und kosteng√ºnstiger. Mehr Ressourcen f√ºr die eigentlichen Funktionen, weniger f√ºr Compliance-Overhead.

**‚ö° Sofortige Demokratie ohne Kompromisse**: Abstimmungen sind vollst√§ndig transparent ‚Äì jeder sieht, wer wie abstimmt. Das schafft echte Verantwortlichkeit und verhindert politische Spielchen.

### 9.2 Technische Eleganz durch Vereinfachung

**Event-Sourcing ohne Privacy-Overhead**: Jede Aktion wird unver√§nderlich dokumentiert, ohne komplexe Zugriffskontrolle oder Privacy-Filter. Das System wird schneller, einfacher und robuster.

**Strukturknoten-Architektur**: Die permanenten Ankerpunkte (Gewebekonto, Webrat, N√§hst√ºbchen) organisieren kollektive Aktivit√§ten bei vollst√§ndiger Transparenz aller Transaktionen und Entscheidungen.

**Byzantine-tolerante Peer-Verifikation**: Ed25519-Signaturen schaffen Vertrauen ohne zentrale Autorit√§t, w√§hrend die Transparenz jeden Betrugsversuch sofort sichtbar macht.

### 9.3 Ethische Klarheit statt regulatorischer Kompromisse

Das Weltgewebe v14.5 w√§hlt **ethische Klarheit √ºber regulatorischen Kompromiss**. Statt komplexer DSGVO-Konstrukte setzt es auf vollst√§ndige Aufkl√§rung und bewusste Entscheidung:

- **Informierte Zustimmung**: Jeder wei√ü exakt, worauf er sich einl√§sst
- **Freiwillige Teilnahme**: Niemand wird zur Transparenz gedr√§ngt  
- **Klare Konsequenzen**: Ausstieg bedeutet vollst√§ndige Anonymisierung und Netzwerk-Verlassen
- **Technische Ehrlichkeit**: Das System versteckt nichts und verspricht nur, was es halten kann

### 9.4 Vision: Authentische Gemeinschaft durch radikale Ehrlichkeit

Das Weltgewebe v14.5 ist **lebende Infrastruktur f√ºr authentische Gemeinschaften**. Wo andere Systeme Intransparenz durch Privacy-Features rechtfertigen, schafft das Weltgewebe Vertrauen durch radikale Offenheit.

**Jede Webung dreht die Rolle sichtbar f√ºr alle, jede Verzwirnung sch√ºtzt dauerhaft transparent, jeder Antrag wird √∂ffentlich abgestimmt, jeder Strukturknoten organisiert Kollektiv-Intelligenz ohne Geheimnisse, jeder Ausstieg ist ehrlich und endg√ºltig.**

Die Strukturknoten werden zu transparenten Organen einer Gesellschaft, die sich selbst organisiert ohne zu verstecken. Goldf√§den zeigen jeden Euro, Abstimmungen jeden Namen, F√§den jede Verbindung.

**‚à¥ Wo Transparenz Vertrauen schafft, Ehrlichkeit Gemeinschaft formt, Strukturen Orientierung geben und Klarheit Freiheit erm√∂glicht ‚Äì das Weltgewebe als authentischer Organismus kollektiven Handelns von der offenen Nachbarschaft bis zum ehrlichen globalen Myzel! üåê‚ú®üîçüö™**

***

*v14.5 ‚Äì Transparenz-First Revolution: Radikale Sichtbarkeit trifft klare Ausstiegs-Konsequenzen mit vereinfachter, kosteng√ºnstiger Architektur*

*Die Weltweberei wird ehrlicher, klarer, einfacher und authentischer ‚Äì jede Webung sichtbar, jede Entscheidung transparent, jeder Ausstieg endg√ºltig, jeder Strukturknoten offen, jede Gemeinschaft authentisch durch radikale Ehrlichkeit!*




# üåê Weltgewebe v14.5.1 ‚Äî Patch: Ron-Option f√ºr automatische 84-Tage-Anonymisierung

***Erg√§nzung zur v14.5 Blaupause***

## PATCH: Ron-System f√ºr zeitbasierte Anonymisierung

### 0) Leitplanken-Erg√§nzung

**Neue Visualsprache:**
- **Ron-Rolle** = Neutraler Platzhalter auf der Karte f√ºr alle anonymisierten Beitr√§ge √§lter als 84 Tage
- **Gekappte F√§den** = F√§den, die von der urspr√ºnglichen Rolle getrennt und an Ron angeheftet wurden
- **84-Tage-Anonymisierung** = Optionale automatische Trennung aller personenbezogenen Verbindungen nach Ablauf der Frist

### 1) UX-Erg√§nzungen

#### 1.1 Ron-Rolle auf der Karte

**Ron als permanente Platzhalter-Rolle:**
```typescript
interface RonVisualization {
  id: "ron-placeholder",
  displayName: "Ron",
  avatar: "anonymous-placeholder",
  coords: [number, number], // Zentrale Position oder dynamisch
  isPermanent: true,
  isPlaceholder: true,
  attachedContent: number, // Anzahl der anonymisierten Beitr√§ge
}

// Render-Logik f√ºr Ron
function renderRonMarker() {
  return {
    position: calculateOptimalRonPosition(), // Zentral oder wenig st√∂rend
    icon: 'anonymous-user',
    label: 'Ron',
    opacity: 0.8,
    className: 'ron-placeholder-role',
    tooltip: `Ron - Platzhalter f√ºr ${getAttachedContentCount()} anonymisierte Beitr√§ge`
  };
}
```

#### 1.2 Ron-Option im Profil-Dashboard

**Neue Sektion im Datenschutz-Bereich:**
```svelte
<div class="ron-anonymization">
  <h4>üé≠ Ron-Anonymisierung (84-Tage-Option)</h4>
  
  <div class="ron-explanation">
    <p><strong>Was ist die Ron-Option?</strong></p>
    <p>Nach 84 Tagen kannst du alle deine √§lteren Beitr√§ge und Verbindungen automatisch an "Ron" √ºbertragen lassen. Deine Beitr√§ge bleiben bestehen, sind aber nicht mehr mit deinem Namen verkn√ºpft.</p>
    
    <div class="ron-benefits">
      <ul>
        <li>‚úì Automatische Anonymisierung nach 84 Tagen</li>
        <li>‚úì Beitr√§ge bleiben f√ºr die Gemeinschaft erhalten</li>
        <li>‚úì Deine aktuellen Aktivit√§ten bleiben sichtbar</li>
        <li>‚úì Jederzeit aktivierbar oder deaktivierbar</li>
      </ul>
    </div>
  </div>
  
  <div class="ron-status" class:active={ronOptionEnabled}>
    <label class="ron-toggle">
      <input 
        type="checkbox" 
        bind:checked={ronOptionEnabled} 
        on:change={updateRonOption}
      />
      <span class="toggle-slider"></span>
      <strong>Ron-Anonymisierung nach 84 Tagen aktivieren</strong>
    </label>
    
    {#if ronOptionEnabled}
      <div class="ron-active-info">
        <p>‚úì Ron-Option ist aktiviert</p>
        <p>Deine Beitr√§ge √§lter als 84 Tage werden automatisch zu "Ron" √ºbertragen.</p>
        
        {#if eligibleForRonTransfer > 0}
          <div class="immediate-transfer">
            <p><strong>{eligibleForRonTransfer} Beitr√§ge</strong> k√∂nnen bereits jetzt √ºbertragen werden.</p>
            <button class="ron-transfer-btn" on:click={triggerImmediateRonTransfer}>
              Sofort an Ron √ºbertragen
            </button>
          </div>
        {/if}
      </div>
    {/if}
  </div>
  
  <div class="ron-preview">
    <h5>Beispiel-Darstellung:</h5>
    <div class="content-preview">
      <div class="before-ron">
        <strong>Vorher:</strong> "Max Mustermann schrieb: Das ist eine gute Idee!"
      </div>
      <div class="after-ron">
        <strong>Nach Ron-Transfer:</strong> "Ron schrieb: Das ist eine gute Idee!"
      </div>
    </div>
  </div>
</div>

<style>
.ron-anonymization {
  background: #e8f5e8;
  border: 2px solid #28a745;
  border-radius: 8px;
  padding: 20px;
  margin: 20px 0;
}

.ron-toggle {
  display: flex;
  align-items: center;
  margin: 15px 0;
  font-size: 16px;
  cursor: pointer;
}

.toggle-slider {
  width: 50px;
  height: 24px;
  background: #ccc;
  border-radius: 24px;
  position: relative;
  margin-right: 10px;
  transition: background 0.3s;
}

.toggle-slider:before {
  content: '';
  position: absolute;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: white;
  top: 2px;
  left: 2px;
  transition: left 0.3s;
}

input:checked + .toggle-slider {
  background: #28a745;
}

input:checked + .toggle-slider:before {
  left: 28px;
}

.ron-active-info {
  background: #d4edda;
  padding: 15px;
  border-radius: 6px;
  margin-top: 10px;
}

.immediate-transfer {
  background: #fff3cd;
  border: 1px solid #ffc107;
  padding: 10px;
  border-radius: 4px;
  margin-top: 10px;
}

.ron-transfer-btn {
  background: #ffc107;
  color: #000;
  border: none;
  padding: 8px 16px;
  border-radius: 4px;
  cursor: pointer;
  margin-top: 8px;
}

.content-preview {
  background: #f8f9fa;
  padding: 15px;
  border-radius: 6px;
  margin-top: 10px;
}

.before-ron {
  color: #6c757d;
  margin-bottom: 5px;
}

.after-ron {
  color: #28a745;
  font-weight: bold;
}
</style>
```

### 2) Dom√§nen-Erg√§nzungen

#### 2.1 Ron-Anonymisierungsregeln

**84-Tage-Automatik mit Ron-Transfer:**
- **Opt-in-Mechanismus**: Nutzer m√ºssen die Ron-Option explizit aktivieren
- **84-Tage-Schwelle**: Nur Inhalte √§lter als 84 Tage sind f√ºr Ron-Transfer berechtigt
- **Automatische √úbertragung**: L√§uft t√§glich als Background-Job bei aktivierter Option
- **Sofortige √úbertragung**: Nutzer k√∂nnen eligible Content sofort √ºbertragen lassen
- **Faden-Trennung**: Alle F√§den werden von der urspr√ºnglichen Rolle getrennt und an Ron angeheftet
- **Content-Update**: Namen werden in allen Beitr√§gen durch "Ron" ersetzt

#### 2.2 Ron-Manager Implementation

```typescript
class RonManager {
  private static readonly RON_USER_ID = 'ron-placeholder-uuid';
  private static readonly ANONYMIZATION_THRESHOLD_DAYS = 84;
  
  async enableRonOption(rolleId: string): Promise<void> {
    // Ron-Option f√ºr Nutzer aktivieren
    await db.rollen.update({
      where: { id: rolleId },
      data: { ron_option_enabled: true, ron_enabled_at: new Date() }
    });
    
    // Event f√ºr Aktivierung
    await eventBus.publish({
      type: 'RonOptionEnabled',
      aggregateId: rolleId,
      subject: 'wg.kleinroennau.social',
      payload: {
        rolleId,
        enabledAt: new Date(),
        thresholdDays: this.ANONYMIZATION_THRESHOLD_DAYS
      }
    });
    
    // Pr√ºfe sofort eligible Content
    await this.checkAndTransferEligibleContent(rolleId);
  }
  
  async disableRonOption(rolleId: string): Promise<void> {
    await db.rollen.update({
      where: { id: rolleId },
      data: { ron_option_enabled: false, ron_disabled_at: new Date() }
    });
    
    // Bereits √ºbertragener Content bleibt bei Ron!
    await eventBus.publish({
      type: 'RonOptionDisabled',
      aggregateId: rolleId,
      subject: 'wg.kleinroennau.social',
      payload: {
        rolleId,
        disabledAt: new Date(),
        note: 'Bereits √ºbertragener Content bleibt bei Ron'
      }
    });
  }
  
  async checkAndTransferEligibleContent(rolleId: string): Promise<RonTransferResult> {
    const user = await db.rollen.findUnique({ where: { id: rolleId } });
    if (!user?.ron_option_enabled) {
      throw new Error('Ron-Option nicht aktiviert');
    }
    
    const thresholdDate = new Date();
    thresholdDate.setDate(thresholdDate.getDate() - this.ANONYMIZATION_THRESHOLD_DAYS);
    
    // Finde alle Inhalte √§lter als 84 Tage
    const eligibleFaeden = await db.faeden.findMany({
      where: {
        from_rolle: rolleId,
        created_at: { lt: thresholdDate },
        transferred_to_ron: false
      }
    });
    
    const eligibleThreads = await db.thread_beitraege.findMany({
      where: {
        rolle_id: rolleId,
        created_at: { lt: thresholdDate },
        transferred_to_ron: false
      }
    });
    
    if (eligibleFaeden.length === 0 && eligibleThreads.length === 0) {
      return { transferred: 0, message: 'Keine Inhalte f√ºr Ron-Transfer verf√ºgbar' };
    }
    
    // √úbertrage zu Ron
    return await this.transferContentToRon(rolleId, eligibleFaeden, eligibleThreads);
  }
  
  private async transferContentToRon(
    rolleId: string, 
    faeden: any[], 
    threads: any[]
  ): Promise<RonTransferResult> {
    const ronRolle = await this.ensureRonRoleExists();
    
    // √úbertrage F√§den
    for (const faden of faeden) {
      await db.faeden.update({
        where: { id: faden.id },
        data: {
          from_rolle: this.RON_USER_ID,
          transferred_to_ron: true,
          original_rolle_id: rolleId, // F√ºr Audit
          ron_transferred_at: new Date()
        }
      });
    }
    
    // √úbertrage Thread-Beitr√§ge
    for (const thread of threads) {
      await db.thread_beitraege.update({
        where: { id: thread.id },
        data: {
          rolle_id: this.RON_USER_ID,
          autor_name: 'Ron', // Name √ºberschreiben
          transferred_to_ron: true,
          original_rolle_id: rolleId,
          ron_transferred_at: new Date()
        }
      });
    }
    
    // Event f√ºr erfolgreiche √úbertragung
    await eventBus.publish({
      type: 'ContentTransferredToRon',
      aggregateId: rolleId,
      subject: 'wg.kleinroennau.social',
      payload: {
        originalRolleId: rolleId,
        ronRolleId: this.RON_USER_ID,
        transferredFaeden: faeden.length,
        transferredThreads: threads.length,
        transferredAt: new Date(),
        thresholdDate: new Date(Date.now() - (this.ANONYMIZATION_THRESHOLD_DAYS * 24 * 60 * 60 * 1000))
      }
    });
    
    return {
      transferred: faeden.length + threads.length,
      message: `${faeden.length} F√§den und ${threads.length} Beitr√§ge erfolgreich an Ron √ºbertragen`
    };
  }
  
  private async ensureRonRoleExists(): Promise<any> {
    let ronRolle = await db.rollen.findUnique({
      where: { id: this.RON_USER_ID }
    });
    
    if (!ronRolle) {
      // Erstelle Ron-Platzhalter-Rolle
      ronRolle = await db.rollen.create({
        data: {
          id: this.RON_USER_ID,
          name: 'Ron',
          email: 'ron@weltgewebe.placeholder',
          avatar: 'anonymous-placeholder',
          coords: st.point(9.993682, 53.551086), // Hamburg Zentrum als Default
          h3: 599686042433355775, // Hamburg H3
          is_placeholder: true,
          is_active: true,
          can_perform_actions: false // Ron kann nicht aktiv handeln
        }
      });
      
      await eventBus.publish({
        type: 'RonPlaceholderCreated',
        aggregateId: this.RON_USER_ID,
        subject: 'wg.kleinroennau.social',
        payload: {
          ronRolleId: this.RON_USER_ID,
          createdAt: new Date(),
          purpose: 'Platzhalter f√ºr anonymisierte Inhalte'
        }
      });
    }
    
    return ronRolle;
  }
  
  async getDailyRonCandidates(): Promise<string[]> {
    // Finde alle Nutzer mit aktivierter Ron-Option
    const usersWithRon = await db.rollen.findMany({
      where: { ron_option_enabled: true },
      select: { id: true }
    });
    
    return usersWithRon.map(u => u.id);
  }
}
```

### 3) Event-Schema-Erg√§nzungen

#### 3.1 Ron-spezifische Events

```json
{
  "type": "RonOptionEnabled",
  "aggregateId": "rolle-uuid",
  "subject": "wg.kleinroennau.social",
  "payload": {
    "rolleId": "rolle-uuid",
    "enabledAt": "2025-08-22T06:00:00Z",
    "thresholdDays": 84,
    "automaticTransfer": true
  },
  "meta": {
    "actor": "rolle-uuid",
    "transparency": "full_public"
  }
}
```

```json
{
  "type": "ContentTransferredToRon",
  "aggregateId": "rolle-uuid",
  "subject": "wg.kleinroennau.social",
  "payload": {
    "originalRolleId": "rolle-uuid",
    "ronRolleId": "ron-placeholder-uuid",
    "transferredFaeden": 12,
    "transferredThreads": 8,
    "transferredAt": "2025-08-22T06:00:00Z",
    "thresholdDate": "2025-05-30T06:00:00Z",
    "totalItemsTransferred": 20
  },
  "meta": {
    "executor": "system",
    "automation": "ron_daily_job"
  }
}
```

### 4) Database-Schema-Erg√§nzungen

```sql
-- Erweitere Rollen-Tabelle um Ron-Option
ALTER TABLE rollen ADD COLUMN ron_option_enabled BOOLEAN DEFAULT FALSE;
ALTER TABLE rollen ADD COLUMN ron_enabled_at TIMESTAMPTZ;
ALTER TABLE rollen ADD COLUMN ron_disabled_at TIMESTAMPTZ;
ALTER TABLE rollen ADD COLUMN is_placeholder BOOLEAN DEFAULT FALSE;

-- Erweitere F√§den f√ºr Ron-Transfers
ALTER TABLE faeden ADD COLUMN transferred_to_ron BOOLEAN DEFAULT FALSE;
ALTER TABLE faeden ADD COLUMN original_rolle_id UUID; -- F√ºr Audit
ALTER TABLE faeden ADD COLUMN ron_transferred_at TIMESTAMPTZ;

-- Erweitere Thread-Beitr√§ge f√ºr Ron-Transfers
ALTER TABLE thread_beitraege ADD COLUMN transferred_to_ron BOOLEAN DEFAULT FALSE;
ALTER TABLE thread_beitraege ADD COLUMN original_rolle_id UUID;
ALTER TABLE thread_beitraege ADD COLUMN ron_transferred_at TIMESTAMPTZ;

-- Ron-Transfer-Audit-Log
CREATE TABLE ron_transfers (
  id UUID PRIMARY KEY,
  original_rolle_id UUID NOT NULL,
  ron_rolle_id UUID NOT NULL,
  transfer_type TEXT NOT NULL, -- 'faeden' | 'threads' | 'mixed'
  items_transferred INTEGER NOT NULL,
  transferred_at TIMESTAMPTZ DEFAULT now(),
  threshold_date TIMESTAMPTZ NOT NULL,
  trigger_type TEXT DEFAULT 'automatic' -- 'automatic' | 'manual'
);

-- Performance-Indizes
CREATE INDEX IF NOT EXISTS idx_rollen_ron_enabled ON rollen(ron_option_enabled) WHERE ron_option_enabled = true;
CREATE INDEX IF NOT EXISTS idx_faeden_ron_eligible ON faeden(from_rolle, created_at, transferred_to_ron) WHERE transferred_to_ron = false;
CREATE INDEX IF NOT EXISTS idx_threads_ron_eligible ON thread_beitraege(rolle_id, created_at, transferred_to_ron) WHERE transferred_to_ron = false;
```

### 5) Background Jobs-Erg√§nzung

```typescript
// T√§glicher Ron-Transfer-Job
async function dailyRonTransferJob() {
  const ronManager = new RonManager();
  const candidates = await ronManager.getDailyRonCandidates();
  
  let totalTransferred = 0;
  const results = [];
  
  for (const rolleId of candidates) {
    try {
      const result = await ronManager.checkAndTransferEligibleContent(rolleId);
      if (result.transferred > 0) {
        totalTransferred += result.transferred;
        results.push({ rolleId, ...result });
      }
    } catch (error) {
      console.error(`Ron-Transfer failed for role ${rolleId}:`, error);
    }
  }
  
  // Monitoring-Metrik
  ronTransferMetrics.set('daily_transfers', totalTransferred);
  
  console.log(`Daily Ron Transfer completed: ${totalTransferred} items transferred for ${results.length} users`);
  
  return { totalTransferred, results };
}

// Schedule: T√§glich um 02:00 Uhr
cron.schedule('0 2 * * *', dailyRonTransferJob);
```

### 6) API-Endpoints-Erg√§nzung

```typescript
// POST /api/me/ron/enable - Ron-Option aktivieren
app.post('/api/me/ron/enable', async (req, reply) => {
  const rolleId = req.user.rolleId;
  
  try {
    await ronManager.enableRonOption(rolleId);
    
    reply.send({
      success: true,
      message: 'Ron-Anonymisierung aktiviert. Deine Beitr√§ge √§lter als 84 Tage werden automatisch an Ron √ºbertragen.',
      thresholdDays: 84
    });
  } catch (error) {
    reply.code(500).send({
      error: 'ron_enable_failed',
      message: error.message
    });
  }
});

// POST /api/me/ron/disable - Ron-Option deaktivieren  
app.post('/api/me/ron/disable', async (req, reply) => {
  const rolleId = req.user.rolleId;
  
  try {
    await ronManager.disableRonOption(rolleId);
    
    reply.send({
      success: true,
      message: 'Ron-Anonymisierung deaktiviert. Bereits √ºbertragene Inhalte bleiben bei Ron.',
      note: 'Zuk√ºnftige Beitr√§ge werden nicht mehr automatisch √ºbertragen.'
    });
  } catch (error) {
    reply.code(500).send({
      error: 'ron_disable_failed', 
      message: error.message
    });
  }
});

// POST /api/me/ron/transfer-now - Sofortige Ron-√úbertragung
app.post('/api/me/ron/transfer-now', async (req, reply) => {
  const rolleId = req.user.rolleId;
  
  try {
    const result = await ronManager.checkAndTransferEligibleContent(rolleId);
    
    reply.send({
      success: true,
      transferred: result.transferred,
      message: result.message
    });
  } catch (error) {
    reply.code(400).send({
      error: 'ron_transfer_failed',
      message: error.message
    });
  }
});

// GET /api/ron/stats - √ñffentliche Ron-Statistiken
app.get('/api/ron/stats', async (req, reply) => {
  const stats = await db.ron_transfers.aggregate({
    _sum: { items_transferred: true },
    _count: { id: true }
  });
  
  const ronContent = await db.faeden.count({
    where: { from_rolle: 'ron-placeholder-uuid' }
  });
  
  reply.send({
    totalTransfers: stats._count.id || 0,
    totalItemsTransferred: stats._sum.items_transferred || 0,
    currentRonContent: ronContent,
    ronRoleInfo: {
      name: 'Ron',
      purpose: 'Platzhalter f√ºr anonymisierte Inhalte √§lter als 84 Tage'
    }
  });
});
```

### 7) Rechtliche Erg√§nzung

**Erweiterte Datenschutzerkl√§rung-Sektion:**

```markdown
## Ron-Anonymisierung (84-Tage-Option)

### Was ist Ron?
Ron ist ein Platzhalter f√ºr anonymisierte Beitr√§ge. Du kannst w√§hlen, dass deine Beitr√§ge nach 84 Tagen automatisch von deinem Namen getrennt und Ron zugeordnet werden.

### Wie funktioniert es?
- **Aktivierung**: Du aktivierst die Ron-Option in deinen Einstellungen
- **Automatisch**: Nach 84 Tagen werden deine Beitr√§ge automatisch an Ron √ºbertragen
- **Reversibilit√§t**: Einmal an Ron √ºbertragen, bleiben Inhalte dauerhaft bei Ron
- **Freiwilligkeit**: Die Ron-Option ist vollst√§ndig optional

### Deine Kontrolle:
- Jederzeit aktivierbar/deaktivierbar
- Sofortige √úbertragung verf√ºgbarer Inhalte m√∂glich
- Bereits √ºbertragene Inhalte bleiben bei Ron (auch bei Deaktivierung)

### Rechtsgrundlage:
Art. 6 Abs. 1 lit. a DSGVO (Einwilligung) - Du stimmst der zeitversetzten Anonymisierung zu.
```

### 8) Monitoring-Erg√§nzung

```typescript
// Ron-spezifische Metriken
export const ronMetrics = {
  ronTransfersDaily: new Counter({
    name: 'wg_ron_transfers_daily_total',
    help: 'T√§gliche Ron-√úbertragungen'
  }),
  
  ronContentVolume: new Gauge({
    name: 'wg_ron_content_items_total', 
    help: 'Gesamtanzahl der bei Ron gehosteten Inhalte'
  }),
  
  ronOptionUsers: new Gauge({
    name: 'wg_ron_option_enabled_users',
    help: 'Anzahl Nutzer mit aktivierter Ron-Option'
  }),
  
  ronEligibleContent: new Gauge({
    name: 'wg_ron_eligible_content_items',
    help: 'Anzahl Inhalte, die f√ºr Ron-Transfer berechtigt sind'
  })
};
```

***

## Zusammenfassung des Ron-Patches

**Was Ron bringt:**
- **DSGVO-konforme Anonymisierung**: Nach 84 Tagen automatische Trennung personenbezogener Daten
- **Community-Kontinuit√§t**: Inhalte bleiben erhalten, aber anonym
- **Nutzerautonomie**: Vollst√§ndig optionales System
- **Einfache UX**: Ein Toggle aktiviert die gesamte Automatik
- **Transparenz**: Alle Ron-Transfers sind √∂ffentlich nachvollziehbar

**Technische Umsetzung:**
- Neue Ron-Platzhalter-Rolle auf der Karte
- 84-Tage-Background-Job f√ºr automatische √úbertragungen
- Faden- und Content-Transfer-Mechanismus  
- Erweiterte Database-Schema mit Ron-Feldern
- Monitoring und Metriken f√ºr Ron-Aktivit√§t

**Das System bleibt bei seiner radikalen Transparenz, bietet aber eine elegante L√∂sung f√ºr zeitversetzte Anonymisierung bei voller Gemeinschafts-Kontinuit√§t.**


v14_5_2 zusatz:

ausstieg wird √ºber ron-prozess geregelt. d.h. er ist erst mach 84 tagen per √ºbertragung aller f√§den etc. auf ron abgeschlossen. zum abschluss wird die rolle vom wohnsitz entfernt (gel√∂scht)